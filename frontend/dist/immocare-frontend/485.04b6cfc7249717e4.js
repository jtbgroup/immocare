"use strict";(self.webpackChunkimmocare_frontend=self.webpackChunkimmocare_frontend||[]).push([[485],{7485:(Ut,b,l)=>{l.r(b),l.d(b,{HousingUnitDetailsComponent:()=>Bt});var c=l(177),g=l(7282),p=l(1413),d=l(6977),F=l(9674),a=l(4341),f=l(6238),t=l(4438),_=l(1626);let v=(()=>{class n{constructor(e){this.http=e,this.base="/api/v1/housing-units"}addScore(e,i){return this.http.post(`${this.base}/${e}/peb-scores`,i)}updateScore(e,i,o){return this.http.put(`${this.base}/${e}/peb-scores/${i}`,o)}deleteScore(e,i){return this.http.delete(`${this.base}/${e}/peb-scores/${i}`)}getHistory(e){return this.http.get(`${this.base}/${e}/peb-scores`)}getCurrentScore(e){return this.http.get(`${this.base}/${e}/peb-scores/current`)}getImprovements(e){return this.http.get(`${this.base}/${e}/peb-scores/improvements`)}static{this.\u0275fac=function(i){return new(i||n)(t.KVO(_.Qq))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function R(n,r){if(1&n&&(t.qex(0),t.j41(1,"span",9),t.EFF(2),t.k0s(),t.EFF(3),t.bVm()),2&n){const e=t.XpG(2);t.R7$(2),t.SpI("\u2191 Improved by ",e.improvement.gradesImproved," grade(s)"),t.R7$(),t.E5c(" over ",e.improvement.yearsCovered," year(s) (",e.display[e.improvement.firstScore].label," \u2192 ",e.display[e.improvement.currentScore].label,") ")}}function k(n,r){if(1&n&&(t.qex(0),t.j41(1,"span",10),t.EFF(2),t.k0s(),t.EFF(3),t.bVm()),2&n){const e=t.XpG(2);t.R7$(2),t.SpI("\u2193 Degraded by ",-1*e.improvement.gradesImproved," grade(s)"),t.R7$(),t.SpI(" over ",e.improvement.yearsCovered," year(s) ")}}function y(n,r){if(1&n&&(t.qex(0),t.j41(1,"span",11),t.EFF(2),t.k0s(),t.bVm()),2&n){const e=t.XpG(2);t.R7$(2),t.SpI("\u2212 No change over ",e.improvement.yearsCovered," year(s)")}}function O(n,r){if(1&n&&(t.j41(0,"div",7),t.DNE(1,R,4,4,"ng-container",8)(2,k,4,2,"ng-container",8)(3,y,3,1,"ng-container",8),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",e.improvement.gradesImproved>0),t.R7$(),t.Y8G("ngIf",e.improvement.gradesImproved<0),t.R7$(),t.Y8G("ngIf",0===e.improvement.gradesImproved)}}function x(n,r){1&n&&(t.j41(0,"div",12),t.EFF(1,"Loading\u2026"),t.k0s())}function I(n,r){1&n&&(t.j41(0,"p",13),t.EFF(1," No PEB scores recorded yet. "),t.k0s())}function E(n,r){if(1&n){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"span",16),t.EFF(3),t.k0s()(),t.j41(4,"td"),t.EFF(5),t.k0s(),t.j41(6,"td"),t.EFF(7),t.k0s(),t.j41(8,"td"),t.EFF(9),t.k0s(),t.j41(10,"td")(11,"span",17),t.EFF(12),t.k0s()(),t.j41(13,"td")(14,"span",18),t.EFF(15),t.k0s()(),t.j41(16,"td",19)(17,"button",20),t.bIt("click",function(){const o=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.editRequest.emit(o))}),t.EFF(18," \u270f\ufe0f "),t.k0s(),t.j41(19,"button",21),t.bIt("click",function(){const o=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.deleteRequest.emit(o))}),t.EFF(20," \u{1f5d1}\ufe0f "),t.k0s()()()}if(2&n){let e,i;const o=r.$implicit,s=t.XpG(2);t.R7$(2),t.xc7("background",s.display[o.pebScore].color)("color",s.display[o.pebScore].textColor),t.R7$(),t.SpI(" ",s.display[o.pebScore].label," "),t.R7$(2),t.JRh(o.scoreDate),t.R7$(2),t.JRh(null!==(e=o.certificateNumber)&&void 0!==e?e:"\u2014"),t.R7$(2),t.JRh(null!==(i=o.validUntil)&&void 0!==i?i:"\u2014"),t.R7$(2),t.Y8G("ngClass",s.statusClass(o.status)),t.R7$(),t.SpI(" ",o.status," "),t.R7$(2),t.Y8G("ngClass",s.improvementClass(s.rowDirection(o))),t.R7$(),t.SpI(" ",s.improvementIcon(s.rowDirection(o))," ")}}function P(n,r){if(1&n&&(t.j41(0,"table",14)(1,"thead")(2,"tr")(3,"th"),t.EFF(4,"Score"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Score Date"),t.k0s(),t.j41(7,"th"),t.EFF(8,"Certificate"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Valid Until"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Status"),t.k0s(),t.j41(13,"th"),t.EFF(14,"Change"),t.k0s(),t.nrm(15,"th"),t.k0s()(),t.j41(16,"tbody"),t.DNE(17,E,21,12,"tr",15),t.k0s()()),2&n){const e=t.XpG();t.R7$(17),t.Y8G("ngForOf",e.history)}}let M=(()=>{class n{constructor(e){this.pebScoreService=e,this.close=new t.bkB,this.editRequest=new t.bkB,this.deleteRequest=new t.bkB,this.history=[],this.improvement=null,this.loading=!1,this.display=f.o,this.destroy$=new p.B}ngOnInit(){this.loadHistory(),this.loadImprovements()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadHistory(){this.loading=!0,this.pebScoreService.getHistory(this.unitId).pipe((0,d.Q)(this.destroy$)).subscribe({next:e=>{this.history=e,this.loading=!1},error:()=>{this.loading=!1}})}loadImprovements(){this.pebScoreService.getImprovements(this.unitId).pipe((0,d.Q)(this.destroy$)).subscribe({next:e=>{this.improvement=e},error:()=>{this.improvement=null}})}improvementIcon(e){return"IMPROVED"===e?"\u2191":"DEGRADED"===e?"\u2193":"\u2212"}improvementClass(e){return"IMPROVED"===e?"improved":"DEGRADED"===e?"degraded":"unchanged"}statusClass(e){return"CURRENT"===e?"status-current":"EXPIRED"===e?"status-expired":"status-historical"}rowDirection(e){if(!this.improvement?.history)return"";const i=this.improvement.history.find(o=>o.toScore===e.pebScore);return i?i.direction:""}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(v))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-peb-history"]],inputs:{unitId:"unitId"},outputs:{close:"close",editRequest:"editRequest",deleteRequest:"deleteRequest"},standalone:!0,features:[t.aNF],decls:10,vars:4,consts:[[1,"history-panel"],[1,"history-header"],[1,"btn-close",3,"click"],["class","improvement-summary",4,"ngIf"],["class","loading",4,"ngIf"],["class","no-data",4,"ngIf"],["class","history-table",4,"ngIf"],[1,"improvement-summary"],[4,"ngIf"],[1,"improved"],[1,"degraded"],[1,"unchanged"],[1,"loading"],[1,"no-data"],[1,"history-table"],[4,"ngFor","ngForOf"],[1,"score-badge"],[1,"status-badge",3,"ngClass"],[3,"ngClass"],[1,"row-actions"],["title","Edit",1,"icon-btn-sm",3,"click"],["title","Delete",1,"icon-btn-sm","icon-btn-delete",3,"click"]],template:function(i,o){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"h4"),t.EFF(3,"PEB Score History"),t.k0s(),t.j41(4,"button",2),t.bIt("click",function(){return o.close.emit()}),t.EFF(5,"\u2715"),t.k0s()(),t.DNE(6,O,4,3,"div",3)(7,x,2,0,"div",4)(8,I,2,0,"p",5)(9,P,18,1,"table",6),t.k0s()),2&i&&(t.R7$(6),t.Y8G("ngIf",o.improvement&&o.improvement.history.length>0),t.R7$(),t.Y8G("ngIf",o.loading),t.R7$(),t.Y8G("ngIf",!o.loading&&0===o.history.length),t.R7$(),t.Y8G("ngIf",!o.loading&&o.history.length>0))},dependencies:[c.MD,c.YU,c.Sq,c.bT],styles:[".history-panel[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:6px;padding:1.25rem;margin-top:1rem;background:#fff}.history-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.history-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:600}.btn-close[_ngcontent-%COMP%]{background:none;border:none;font-size:1.1rem;cursor:pointer;color:#555}.btn-close[_ngcontent-%COMP%]:hover{color:#000}.improvement-summary[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#f5f5f5;border-radius:6px;margin-bottom:1rem;font-size:.9rem}.history-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem}.history-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .history-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.6rem .8rem;border-bottom:1px solid #e0e0e0;text-align:left}.history-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;background:#fafafa}.score-badge[_ngcontent-%COMP%]{display:inline-block;padding:.2rem .6rem;border-radius:4px;font-weight:700;font-size:.85rem}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:.15rem .5rem;border-radius:4px;font-size:.78rem;font-weight:600}.status-current[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.status-historical[_ngcontent-%COMP%]{background:#f5f5f5;color:#616161}.status-expired[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.improved[_ngcontent-%COMP%]{color:#2e7d32;font-weight:700}.degraded[_ngcontent-%COMP%]{color:#c62828;font-weight:700}.unchanged[_ngcontent-%COMP%]{color:#9e9e9e;font-weight:700}.loading[_ngcontent-%COMP%], .no-data[_ngcontent-%COMP%]{color:#888;padding:.5rem 0}.row-actions[_ngcontent-%COMP%]{white-space:nowrap;text-align:right}.icon-btn-sm[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:.85rem;padding:.2rem .3rem;border-radius:4px;opacity:.6;transition:opacity .15s}.icon-btn-sm[_ngcontent-%COMP%]:hover{opacity:1;background:#f5f5f5}.icon-btn-sm.icon-btn-delete[_ngcontent-%COMP%]:hover{background:#ffebee}"]})}}return n})();function S(n,r){if(1&n){const e=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.openForm())}),t.EFF(1," + Set PEB "),t.k0s()}}function j(n,r){1&n&&(t.j41(0,"div",9),t.EFF(1,"Loading\u2026"),t.k0s())}function $(n,r){if(1&n&&(t.j41(0,"div",19),t.EFF(1," Valid until: "),t.j41(2,"strong"),t.EFF(3),t.k0s(),t.j41(4,"span",20),t.EFF(5),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(3),t.JRh(e.current.validUntil),t.R7$(),t.Y8G("ngClass",e.expiryClass),t.R7$(),t.JRh(e.expiryLabel)}}function w(n,r){1&n&&(t.j41(0,"div",21),t.EFF(1," Validity period not specified "),t.k0s())}function T(n,r){if(1&n&&(t.j41(0,"div",22),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.SpI(" Certificate: ",e.current.certificateNumber," ")}}function G(n,r){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"div",10)(2,"div",11),t.EFF(3),t.k0s(),t.j41(4,"div",12)(5,"div",13),t.EFF(6," Score date: "),t.j41(7,"strong"),t.EFF(8),t.k0s()(),t.DNE(9,$,6,3,"div",14)(10,w,2,0,"div",15)(11,T,2,1,"div",16),t.k0s()(),t.j41(12,"div",17)(13,"button",18),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.toggleHistory())}),t.EFF(14),t.k0s()(),t.bVm()}if(2&n){const e=t.XpG();t.R7$(2),t.xc7("background",e.display[e.current.pebScore].color)("color",e.display[e.current.pebScore].textColor),t.R7$(),t.SpI(" ",e.display[e.current.pebScore].label," "),t.R7$(5),t.JRh(e.current.scoreDate),t.R7$(),t.Y8G("ngIf",e.current.validUntil),t.R7$(),t.Y8G("ngIf",!e.current.validUntil),t.R7$(),t.Y8G("ngIf",e.current.certificateNumber),t.R7$(3),t.SpI(" ",e.showHistory?"Hide History":"View History"," ")}}function D(n,r){1&n&&(t.j41(0,"p",23),t.EFF(1," No PEB score recorded. "),t.k0s())}function N(n,r){if(1&n&&(t.j41(0,"div",39),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(e.saveError)}}function Y(n,r){if(1&n&&(t.j41(0,"option",40),t.EFF(1),t.k0s()),2&n){const e=r.$implicit,i=t.XpG(2);t.Y8G("value",e),t.R7$(),t.SpI(" ",i.display[e].label," ")}}function X(n,r){1&n&&(t.j41(0,"div",41),t.EFF(1," PEB score is required "),t.k0s())}function A(n,r){1&n&&(t.j41(0,"div",41),t.EFF(1," Score date is required "),t.k0s())}function V(n,r){1&n&&(t.j41(0,"div",41),t.EFF(1," Valid until must be after score date "),t.k0s())}function H(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",24)(1,"h4"),t.EFF(2,"Set PEB Score"),t.k0s(),t.DNE(3,N,2,1,"div",25),t.j41(4,"form",26),t.bIt("ngSubmit",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.save())}),t.j41(5,"div",27)(6,"label"),t.EFF(7,"PEB Score "),t.j41(8,"span",28),t.EFF(9,"*"),t.k0s()(),t.j41(10,"select",29)(11,"option",30),t.EFF(12,"Select a score"),t.k0s(),t.DNE(13,Y,2,2,"option",31),t.k0s(),t.DNE(14,X,2,0,"div",32),t.k0s(),t.j41(15,"div",27)(16,"label"),t.EFF(17,"Score Date "),t.j41(18,"span",28),t.EFF(19,"*"),t.k0s()(),t.nrm(20,"input",33),t.DNE(21,A,2,0,"div",32),t.k0s(),t.j41(22,"div",27)(23,"label"),t.EFF(24,"Certificate Number"),t.k0s(),t.nrm(25,"input",34),t.k0s(),t.j41(26,"div",27)(27,"label"),t.EFF(28,"Valid Until"),t.k0s(),t.nrm(29,"input",35),t.DNE(30,V,2,0,"div",32),t.k0s(),t.j41(31,"div",36)(32,"button",37),t.EFF(33),t.k0s(),t.j41(34,"button",38),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.closeForm())}),t.EFF(35," Cancel "),t.k0s()()()()}if(2&n){let e,i,o;const s=t.XpG();t.R7$(3),t.Y8G("ngIf",s.saveError),t.R7$(),t.Y8G("formGroup",s.form),t.R7$(7),t.Y8G("value",null),t.R7$(2),t.Y8G("ngForOf",s.scores),t.R7$(),t.Y8G("ngIf",(null==(e=s.form.get("pebScore"))?null:e.invalid)&&(null==(e=s.form.get("pebScore"))?null:e.touched)),t.R7$(6),t.Y8G("max",s.today),t.R7$(),t.Y8G("ngIf",(null==(i=s.form.get("scoreDate"))?null:i.invalid)&&(null==(i=s.form.get("scoreDate"))?null:i.touched)),t.R7$(9),t.Y8G("ngIf",null==(o=s.form.get("validUntil"))||null==o.errors?null:o.errors.invalidRange),t.R7$(2),t.Y8G("disabled",s.saving),t.R7$(),t.SpI(" ",s.saving?"Saving\u2026":"Save"," "),t.R7$(),t.Y8G("disabled",s.saving)}}function q(n,r){if(1&n){const e=t.RV6();t.j41(0,"app-peb-history",42),t.bIt("close",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.showHistory=!1)})("editRequest",function(o){t.eBV(e);const s=t.XpG();return t.Njj(s.onEditPeb(o))})("deleteRequest",function(o){t.eBV(e);const s=t.XpG();return t.Njj(s.onDeletePeb(o))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("unitId",e.unitId)}}let B=(()=>{class n{constructor(e,i){this.pebScoreService=e,this.fb=i,this.current=null,this.loading=!1,this.showForm=!1,this.showHistory=!1,this.saving=!1,this.error=null,this.saveError=null,this.editingId=null,this.scores=f.q,this.display=f.o,this.today=(new Date).toISOString().split("T")[0],this.destroy$=new p.B}ngOnInit(){this.buildForm(),this.loadCurrentScore()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}buildForm(){this.form=this.fb.group({pebScore:[null,a.k0.required],scoreDate:[null,a.k0.required],certificateNumber:[null],validUntil:[null]},{validators:this.validUntilAfterScoreDate})}validUntilAfterScoreDate(e){const i=e.get("scoreDate")?.value,o=e.get("validUntil")?.value;return i&&o&&o<=i?(e.get("validUntil")?.setErrors({invalidRange:!0}),{invalidRange:!0}):null}loadCurrentScore(){this.loading=!0,this.pebScoreService.getCurrentScore(this.unitId).pipe((0,d.Q)(this.destroy$)).subscribe({next:e=>{this.current=e,this.loading=!1},error:e=>{(204===e.status||404===e.status)&&(this.current=null),this.loading=!1}})}toggleHistory(){this.showHistory=!this.showHistory}openForm(){this.editingId=null,this.form.reset(),this.saveError=null,this.showForm=!0,this.showHistory=!1}closeForm(){this.showForm=!1,this.editingId=null}onEditPeb(e){this.editingId=e.id,this.form.patchValue({pebScore:e.pebScore,scoreDate:e.scoreDate,certificateNumber:e.certificateNumber??null,validUntil:e.validUntil??null}),this.saveError=null,this.showForm=!0,this.showHistory=!1}onDeletePeb(e){confirm(`Delete PEB score ${this.display[e.pebScore].label} from ${e.scoreDate}?`)&&this.pebScoreService.deleteScore(this.unitId,e.id).pipe((0,d.Q)(this.destroy$)).subscribe({next:()=>{this.loadCurrentScore(),this.showHistory&&(this.showHistory=!1,setTimeout(()=>this.showHistory=!0,0))},error:i=>{alert(i.error?.message||"Failed to delete PEB score.")}})}save(){if(this.form.invalid)return void this.form.markAllAsTouched();this.saving=!0,this.saveError=null;const e={pebScore:this.form.value.pebScore,scoreDate:this.form.value.scoreDate,certificateNumber:this.form.value.certificateNumber||null,validUntil:this.form.value.validUntil||null};(this.editingId?this.pebScoreService.updateScore(this.unitId,this.editingId,e):this.pebScoreService.addScore(this.unitId,e)).pipe((0,d.Q)(this.destroy$)).subscribe({next:()=>{this.saving=!1,this.showForm=!1,this.editingId=null,this.loadCurrentScore()},error:o=>{this.saving=!1,this.saveError=o.error?.message||"An error occurred while saving."}})}get expiryClass(){const e=this.current?.expiryWarning;return"EXPIRED"===e?"badge-expired":"EXPIRING_SOON"===e?"badge-warning":"VALID"===e?"badge-valid":"badge-nodate"}get expiryLabel(){const e=this.current?.expiryWarning;return"EXPIRED"===e?"Expired":"EXPIRING_SOON"===e?"Expires soon":"VALID"===e?"Valid":"No expiry date"}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(v),t.rXU(a.ok))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-peb-section"]],inputs:{unitId:"unitId"},standalone:!0,features:[t.aNF],decls:10,vars:6,consts:[[1,"peb-section"],[1,"section-header"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","loading",4,"ngIf"],[4,"ngIf"],["class","no-data",4,"ngIf"],["class","peb-form-panel",4,"ngIf"],[3,"unitId","close","editRequest","deleteRequest",4,"ngIf"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"loading"],[1,"peb-card"],[1,"peb-score-badge"],[1,"peb-details"],[1,"peb-date"],["class","peb-validity",4,"ngIf"],["class","peb-validity text-muted",4,"ngIf"],["class","peb-cert",4,"ngIf"],[1,"peb-actions"],[1,"btn","btn-link",3,"click"],[1,"peb-validity"],[1,"badge",3,"ngClass"],[1,"peb-validity","text-muted"],[1,"peb-cert"],[1,"no-data"],[1,"peb-form-panel"],["class","error-banner",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"form-group"],[1,"required"],["formControlName","pebScore",1,"form-control"],["disabled","","selected","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["class","field-error",4,"ngIf"],["type","date","formControlName","scoreDate",1,"form-control",3,"max"],["type","text","formControlName","certificateNumber","maxlength","50","placeholder","e.g. PEB-2024-123456",1,"form-control"],["type","date","formControlName","validUntil",1,"form-control"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"error-banner"],[3,"value"],[1,"field-error"],[3,"close","editRequest","deleteRequest","unitId"]],template:function(i,o){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"h3"),t.EFF(3,"Energy Performance (PEB)"),t.k0s(),t.DNE(4,S,2,0,"button",2),t.k0s(),t.DNE(5,j,2,0,"div",3)(6,G,15,10,"ng-container",4)(7,D,2,0,"p",5)(8,H,36,11,"div",6)(9,q,1,1,"app-peb-history",7),t.k0s()),2&i&&(t.R7$(4),t.Y8G("ngIf",!o.showForm&&!o.loading),t.R7$(),t.Y8G("ngIf",o.loading),t.R7$(),t.Y8G("ngIf",!o.loading&&o.current&&!o.showForm),t.R7$(),t.Y8G("ngIf",!o.loading&&!o.current&&!o.showForm),t.R7$(),t.Y8G("ngIf",o.showForm),t.R7$(),t.Y8G("ngIf",o.showHistory&&!o.showForm))},dependencies:[c.MD,c.YU,c.Sq,c.bT,a.X1,a.qT,a.xH,a.y7,a.me,a.wz,a.BC,a.cb,a.tU,a.j4,a.JD,M],styles:[".peb-section[_ngcontent-%COMP%]{margin-top:0}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.peb-card[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:1rem;padding:1rem;border:1px solid #e0e0e0;border-radius:6px;background:#fafafa}.peb-score-badge[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:3rem;height:3rem;border-radius:6px;font-size:1.1rem;font-weight:700;flex-shrink:0}.peb-details[_ngcontent-%COMP%]{flex:1;line-height:1.8}.peb-date[_ngcontent-%COMP%], .peb-validity[_ngcontent-%COMP%], .peb-cert[_ngcontent-%COMP%]{font-size:.9rem}.text-muted[_ngcontent-%COMP%]{color:#888}.badge[_ngcontent-%COMP%]{display:inline-block;padding:.15rem .5rem;border-radius:4px;font-size:.75rem;font-weight:600;margin-left:.5rem}.badge-valid[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge-warning[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.badge-expired[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.badge-nodate[_ngcontent-%COMP%]{background:#f5f5f5;color:#757575}.peb-actions[_ngcontent-%COMP%]{margin-top:.5rem}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#007bff;cursor:pointer;padding:0;font-size:.9rem}.btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.no-data[_ngcontent-%COMP%]{color:#888;font-style:italic}.peb-form-panel[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:6px;padding:1.25rem;margin-top:1rem;background:#fff}.peb-form-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:.875rem;font-weight:500;margin-bottom:.25rem}.form-control[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ccc;border-radius:4px;font-size:.9rem}.required[_ngcontent-%COMP%]{color:#d32f2f}.field-error[_ngcontent-%COMP%]{color:#d32f2f;font-size:.8rem;margin-top:.25rem}.error-banner[_ngcontent-%COMP%]{background:#ffebee;color:#c62828;padding:.75rem;border-radius:4px;margin-bottom:1rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1.25rem}.btn[_ngcontent-%COMP%]{padding:.5rem 1.25rem;border:none;border-radius:4px;cursor:pointer;font-size:.9rem}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#545b62}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-sm[_ngcontent-%COMP%]{padding:.35rem .8rem;font-size:.85rem}.loading[_ngcontent-%COMP%]{color:#888;padding:.5rem 0}"]})}}return n})();function h(n,r){const e=r-n;return{amount:e,percentage:Math.round(e/n*1e4)/100,isIncrease:e>=0}}var C=l(5312);let U=(()=>{class n{constructor(e){this.http=e,this.baseUrl=C.c.apiUrl}getRentHistory(e){return this.http.get(`${this.baseUrl}/housing-units/${e}/rents`)}getCurrentRent(e){return this.http.get(`${this.baseUrl}/housing-units/${e}/rents/current`)}addRent(e,i){return this.http.post(`${this.baseUrl}/housing-units/${e}/rents`,i)}updateRent(e,i,o){return this.http.put(`${this.baseUrl}/housing-units/${e}/rents/${i}`,o)}deleteRent(e,i){return this.http.delete(`${this.baseUrl}/housing-units/${e}/rents/${i}`)}static{this.\u0275fac=function(i){return new(i||n)(t.KVO(_.Qq))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function z(n,r){if(1&n){const e=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.openAddForm())}),t.EFF(1," + Set Rent "),t.k0s()}}function Q(n,r){1&n&&(t.j41(0,"div",11),t.EFF(1,"Loading\u2026"),t.k0s())}function L(n,r){1&n&&(t.j41(0,"p",12),t.EFF(1," No rent recorded. "),t.k0s())}function J(n,r){if(1&n&&(t.j41(0,"div",18),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG(2);t.AVh("positive",e.lastChange.isIncrease)("negative",!e.lastChange.isIncrease),t.R7$(),t.SjE(" ",e.lastChange.isIncrease?"\u2191":"\u2193"," ",e.lastChange.isIncrease?"+":"","\u20ac",t.i5U(2,9,e.lastChange.amount,"1.2-2")," (",e.lastChange.isIncrease?"+":"","",e.lastChange.percentage,"%) vs previous ")}}function K(n,r){if(1&n&&(t.j41(0,"div",13)(1,"div",14),t.EFF(2),t.nI1(3,"number"),t.k0s(),t.j41(4,"div",15)(5,"div",16),t.EFF(6," Effective from: "),t.j41(7,"strong"),t.EFF(8),t.k0s()(),t.DNE(9,J,3,12,"div",17),t.k0s()()),2&n){const e=t.XpG();t.R7$(2),t.SpI(" \u20ac",t.i5U(3,3,e.currentRent.monthlyRent,"1.0-0")," "),t.R7$(6),t.JRh(e.currentRent.effectiveFrom),t.R7$(),t.Y8G("ngIf",e.lastChange)}}function W(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",19)(1,"button",20),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.toggleHistory())}),t.EFF(2),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(2),t.SpI(" ",e.showHistory?"Hide History":"View History"," ")}}function Z(n,r){if(1&n&&(t.j41(0,"div",37)(1,"span"),t.EFF(2,"Editing record from:"),t.k0s(),t.j41(3,"strong"),t.EFF(4),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.JRh(e.editingRecord.effectiveFrom)}}function tt(n,r){1&n&&(t.j41(0,"span",38),t.EFF(1," Rent must be positive "),t.k0s())}function et(n,r){if(1&n&&(t.j41(0,"span",39),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG(2);t.AVh("positive",e.previewChange.isIncrease)("negative",!e.previewChange.isIncrease),t.R7$(),t.LHq(" ",e.previewChange.isIncrease?"+":"","\u20ac",t.i5U(2,8,e.previewChange.amount,"1.2-2")," (",e.previewChange.isIncrease?"+":"","",e.previewChange.percentage,"%) ")}}function nt(n,r){1&n&&(t.j41(0,"span",38),t.EFF(1,"Date is required"),t.k0s())}function ot(n,r){if(1&n&&(t.j41(0,"div",40),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(e.saveError)}}function it(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",21)(1,"h4"),t.EFF(2),t.k0s(),t.DNE(3,Z,5,1,"div",22),t.j41(4,"form",23),t.bIt("ngSubmit",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.saveForm())}),t.j41(5,"div",24)(6,"label"),t.EFF(7,"Monthly Rent (\u20ac) "),t.j41(8,"span",25),t.EFF(9,"*"),t.k0s()(),t.j41(10,"input",26),t.mxI("ngModelChange",function(o){t.eBV(e);const s=t.XpG();return t.DH7(s.formRent,o)||(s.formRent=o),t.Njj(o)}),t.bIt("input",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.onAmountChange())}),t.k0s(),t.DNE(11,tt,2,0,"span",27)(12,et,3,11,"span",28),t.k0s(),t.j41(13,"div",24)(14,"label"),t.EFF(15,"Effective From "),t.j41(16,"span",25),t.EFF(17,"*"),t.k0s()(),t.j41(18,"input",29),t.mxI("ngModelChange",function(o){t.eBV(e);const s=t.XpG();return t.DH7(s.formDate,o)||(s.formDate=o),t.Njj(o)}),t.k0s(),t.DNE(19,nt,2,0,"span",27),t.k0s(),t.j41(20,"div",24)(21,"label"),t.EFF(22,"Notes (optional)"),t.k0s(),t.j41(23,"div",30)(24,"button",31),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.applyTemplate("Annual indexation"))}),t.EFF(25," Annual indexation "),t.k0s(),t.j41(26,"button",31),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.applyTemplate("Market adjustment"))}),t.EFF(27," Market adjustment "),t.k0s(),t.j41(28,"button",31),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.applyTemplate("After renovation"))}),t.EFF(29," After renovation "),t.k0s(),t.j41(30,"button",31),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.applyTemplate("Tenant negotiation"))}),t.EFF(31," Tenant negotiation "),t.k0s()(),t.j41(32,"textarea",32),t.mxI("ngModelChange",function(o){t.eBV(e);const s=t.XpG();return t.DH7(s.formNotes,o)||(s.formNotes=o),t.Njj(o)}),t.k0s()(),t.DNE(33,ot,2,1,"div",33),t.j41(34,"div",34)(35,"button",35),t.EFF(36),t.k0s(),t.j41(37,"button",36),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.closeForm())}),t.EFF(38," Cancel "),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(2),t.JRh(e.editingRecord?"Edit Rent":"Add Rent"),t.R7$(),t.Y8G("ngIf",e.editingRecord),t.R7$(7),t.AVh("invalid",e.submitted&&(!e.formRent||e.formRent<=0)),t.R50("ngModel",e.formRent),t.R7$(),t.Y8G("ngIf",e.submitted&&(!e.formRent||e.formRent<=0)),t.R7$(),t.Y8G("ngIf",e.editingRecord&&e.formRent&&e.formRent>0&&e.previewChange),t.R7$(6),t.AVh("invalid",e.submitted&&!e.formDate),t.R50("ngModel",e.formDate),t.R7$(),t.Y8G("ngIf",e.submitted&&!e.formDate),t.R7$(13),t.R50("ngModel",e.formNotes),t.R7$(),t.Y8G("ngIf",e.saveError),t.R7$(2),t.Y8G("disabled",e.saving),t.R7$(),t.SpI(" ",e.saving?"Saving\u2026":"Save"," "),t.R7$(),t.Y8G("disabled",e.saving)}}function rt(n,r){if(1&n&&(t.j41(0,"div",46),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG(2);t.AVh("improved",e.totalChange.isIncrease)("degraded",!e.totalChange.isIncrease),t.R7$(),t.LHq(" Total since first rent: ",e.totalChange.isIncrease?"+":"","\u20ac",t.i5U(2,8,e.totalChange.amount,"1.2-2")," (",e.totalChange.isIncrease?"+":"","",e.totalChange.percentage,"%) ")}}function st(n,r){1&n&&(t.j41(0,"p",12),t.EFF(1," No history available. "),t.k0s())}function at(n,r){if(1&n&&(t.qex(0),t.j41(1,"span"),t.EFF(2),t.nI1(3,"number"),t.k0s(),t.bVm()),2&n){const e=r.ngIf;t.R7$(),t.AVh("positive",e.isIncrease)("negative",!e.isIncrease),t.R7$(),t.LHq(" ",e.isIncrease?"\u2191 +":"\u2193 ","\u20ac",t.i5U(3,8,e.amount,"1.2-2")," (",e.isIncrease?"+":"","",e.percentage,"%) ")}}function ct(n,r){1&n&&t.EFF(0,"\u2014")}function dt(n,r){if(1&n){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"strong"),t.EFF(3),t.nI1(4,"number"),t.k0s()(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.DNE(12,at,4,11,"ng-container",49)(13,ct,1,0,"ng-template",null,0,t.C5r),t.k0s(),t.j41(15,"td"),t.EFF(16),t.k0s(),t.j41(17,"td",50)(18,"button",51),t.bIt("click",function(){const o=t.eBV(e).$implicit,s=t.XpG(3);return t.Njj(s.openEditForm(o))}),t.EFF(19," \u270f\ufe0f "),t.k0s(),t.j41(20,"button",52),t.bIt("click",function(){const o=t.eBV(e).$implicit,s=t.XpG(3);return t.Njj(s.askDelete(o))}),t.EFF(21," \u{1f5d1}\ufe0f "),t.k0s()()()}if(2&n){let e,i;const o=r.$implicit,s=r.index,u=t.sdS(14),m=t.XpG(3);t.R7$(3),t.SpI("\u20ac",t.i5U(4,8,o.monthlyRent,"1.2-2"),""),t.R7$(3),t.JRh(o.effectiveFrom),t.R7$(2),t.JRh(null!==(e=o.effectiveTo)&&void 0!==e?e:"Current"),t.R7$(2),t.Lme(" ",o.durationMonths," month",1!==o.durationMonths?"s":""," "),t.R7$(2),t.Y8G("ngIf",m.rowChanges[s])("ngIfElse",u),t.R7$(4),t.JRh(null!==(i=o.notes)&&void 0!==i?i:"\u2014")}}function lt(n,r){if(1&n&&(t.j41(0,"table",47)(1,"thead")(2,"tr")(3,"th"),t.EFF(4,"Monthly Rent"),t.k0s(),t.j41(5,"th"),t.EFF(6,"From"),t.k0s(),t.j41(7,"th"),t.EFF(8,"To"),t.k0s(),t.j41(9,"th"),t.EFF(10,"Duration"),t.k0s(),t.j41(11,"th"),t.EFF(12,"Change"),t.k0s(),t.j41(13,"th"),t.EFF(14,"Notes"),t.k0s(),t.nrm(15,"th"),t.k0s()(),t.j41(16,"tbody"),t.DNE(17,dt,22,11,"tr",48),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(17),t.Y8G("ngForOf",e.history)}}function mt(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",41)(1,"div",42)(2,"h4"),t.EFF(3,"Rent History"),t.k0s(),t.j41(4,"button",43),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.toggleHistory())}),t.EFF(5,"\u2715"),t.k0s()(),t.DNE(6,rt,3,11,"div",44)(7,st,2,0,"p",5)(8,lt,18,1,"table",45),t.k0s()}if(2&n){const e=t.XpG();t.R7$(6),t.Y8G("ngIf",e.totalChange),t.R7$(),t.Y8G("ngIf",0===e.history.length),t.R7$(),t.Y8G("ngIf",e.history.length>0)}}let pt=(()=>{class n{constructor(e){this.rentService=e,this.currentRent=null,this.history=[],this.rowChanges=[],this.lastChange=null,this.totalChange=null,this.showForm=!1,this.showHistory=!1,this.loading=!1,this.saving=!1,this.submitted=!1,this.saveError="",this.editingRecord=null,this.deleteTarget=null,this.formRent=null,this.formDate="",this.formNotes="",this.previewChange=null,this.destroy$=new p.B}ngOnChanges(e){e.unitId&&this.unitId&&this.loadCurrentRent()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadCurrentRent(){this.loading=!0,this.rentService.getCurrentRent(this.unitId).pipe((0,d.Q)(this.destroy$)).subscribe({next:e=>{this.currentRent=e??null,this.loading=!1,this.currentRent&&this.loadHistoryForChange()},error:e=>{(204===e.status||404===e.status)&&(this.currentRent=null),this.loading=!1}})}loadHistoryForChange(){this.rentService.getRentHistory(this.unitId).pipe((0,d.Q)(this.destroy$)).subscribe({next:e=>{this.history=e,this.computeChanges()}})}toggleHistory(){this.showHistory=!this.showHistory,this.showHistory&&0===this.history.length&&this.loadHistory()}loadHistory(){this.rentService.getRentHistory(this.unitId).pipe((0,d.Q)(this.destroy$)).subscribe({next:e=>{this.history=e,this.computeChanges()}})}computeChanges(){this.rowChanges=this.history.map((e,i)=>{const o=this.history[i+1];return o?h(o.monthlyRent,e.monthlyRent):null}),this.lastChange=this.rowChanges[0]??null,this.totalChange=this.history.length>=2?h(this.history[this.history.length-1].monthlyRent,this.history[0].monthlyRent):null}openAddForm(){this.editingRecord=null,this.showForm=!0,this.deleteTarget=null,this.submitted=!1,this.saveError="",this.formRent=null,this.formDate="",this.formNotes="",this.previewChange=null}openEditForm(e){this.editingRecord=e,this.showForm=!0,this.showHistory=!1,this.deleteTarget=null,this.submitted=!1,this.saveError="",this.formRent=e.monthlyRent,this.formDate=e.effectiveFrom,this.formNotes=e.notes??"",this.previewChange=null}closeForm(){this.showForm=!1,this.editingRecord=null,this.submitted=!1,this.saveError=""}onAmountChange(){this.previewChange=this.editingRecord&&this.formRent&&this.formRent>0?h(this.editingRecord.monthlyRent,this.formRent):null}applyTemplate(e){this.formNotes=e}saveForm(){if(this.submitted=!0,!this.formRent||this.formRent<=0||!this.formDate)return;const e={monthlyRent:this.formRent,effectiveFrom:this.formDate,notes:this.formNotes||null};this.saving=!0,this.saveError="",(this.editingRecord?this.rentService.updateRent(this.unitId,this.editingRecord.id,e):this.rentService.addRent(this.unitId,e)).pipe((0,d.Q)(this.destroy$)).subscribe({next:()=>{this.showForm=!1,this.saving=!1,this.editingRecord=null,this.loadCurrentRent(),this.showHistory&&this.loadHistory()},error:o=>{this.saving=!1,this.saveError=o.error?.message??"Failed to save rent."}})}askDelete(e){this.deleteTarget=e,this.showForm=!1}confirmDelete(){this.deleteTarget&&(this.saving=!0,this.rentService.deleteRent(this.unitId,this.deleteTarget.id).pipe((0,d.Q)(this.destroy$)).subscribe({next:()=>{this.saving=!1,this.deleteTarget=null,this.loadCurrentRent(),this.showHistory&&this.loadHistory()},error:e=>{this.saving=!1,this.saveError=e.error?.message??"Failed to delete rent.",this.deleteTarget=null}}))}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(U))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-rent-section"]],inputs:{unitId:"unitId"},standalone:!0,features:[t.OA$,t.aNF],decls:11,vars:7,consts:[["noChange",""],[1,"rent-section"],[1,"section-header"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","loading",4,"ngIf"],["class","no-data",4,"ngIf"],["class","rent-card",4,"ngIf"],["class","rent-actions",4,"ngIf"],["class","rent-form-panel",4,"ngIf"],["class","history-panel",4,"ngIf"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"loading"],[1,"no-data"],[1,"rent-card"],[1,"rent-amount-badge"],[1,"rent-details"],[1,"rent-date"],["class","rent-change",3,"positive","negative",4,"ngIf"],[1,"rent-change"],[1,"rent-actions"],[1,"btn-link",3,"click"],[1,"rent-form-panel"],["class","current-read-only",4,"ngIf"],[3,"ngSubmit"],[1,"form-field"],[1,"required"],["type","number","step","0.01","min","0.01","name","monthlyRent","required","",3,"ngModelChange","input","ngModel"],["class","field-error",4,"ngIf"],["class","change-preview",3,"positive","negative",4,"ngIf"],["type","date","name","effectiveFrom","required","",3,"ngModelChange","ngModel"],[1,"notes-templates"],["type","button",1,"tag",3,"click"],["name","notes","rows","2","maxlength","500","placeholder","Optional \u2014 reason for this change",3,"ngModelChange","ngModel"],["class","error-banner",4,"ngIf"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"current-read-only"],[1,"field-error"],[1,"change-preview"],[1,"error-banner"],[1,"history-panel"],[1,"history-header"],[1,"btn-close",3,"click"],["class","improvement-summary",3,"improved","degraded",4,"ngIf"],["class","history-table",4,"ngIf"],[1,"improvement-summary"],[1,"history-table"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[1,"row-actions"],["title","Edit",1,"icon-btn-sm",3,"click"],["title","Delete",1,"icon-btn-sm","icon-btn-delete",3,"click"]],template:function(i,o){1&i&&(t.j41(0,"section",1)(1,"div",2)(2,"h3"),t.EFF(3,"Rent"),t.k0s(),t.DNE(4,z,2,0,"button",3),t.k0s(),t.DNE(5,Q,2,0,"div",4)(6,L,2,0,"p",5)(7,K,10,6,"div",6)(8,W,3,1,"div",7)(9,it,39,16,"div",8)(10,mt,9,3,"div",9),t.k0s()),2&i&&(t.R7$(4),t.Y8G("ngIf",!o.showForm&&!o.loading),t.R7$(),t.Y8G("ngIf",o.loading),t.R7$(),t.Y8G("ngIf",!o.loading&&!o.currentRent&&!o.showForm),t.R7$(),t.Y8G("ngIf",o.currentRent&&!o.showForm),t.R7$(),t.Y8G("ngIf",o.currentRent&&!o.showForm),t.R7$(),t.Y8G("ngIf",o.showForm),t.R7$(),t.Y8G("ngIf",o.showHistory&&!o.showForm))},dependencies:[c.MD,c.Sq,c.bT,c.QX,a.YN,a.qT,a.me,a.Q0,a.BC,a.cb,a.YS,a.tU,a.VZ,a.vS,a.cV],styles:[".rent-section[_ngcontent-%COMP%]{margin-top:0}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.rent-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;border:1px solid #e0e0e0;border-radius:6px;background:#fafafa}.rent-amount-badge[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-width:4.5rem;height:3rem;padding:0 .75rem;border-radius:6px;font-size:1.05rem;font-weight:700;background:#e3f2fd;color:#1565c0;flex-shrink:0;white-space:nowrap}.rent-details[_ngcontent-%COMP%]{flex:1;line-height:1.8}.rent-date[_ngcontent-%COMP%]{font-size:.9rem;color:#555}.rent-change[_ngcontent-%COMP%]{font-size:.85rem}.icon-btn-sm[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:.85rem;padding:.2rem .3rem;border-radius:4px;opacity:.6;transition:opacity .15s}.icon-btn-sm[_ngcontent-%COMP%]:hover{opacity:1;background:#f5f5f5}.icon-btn-sm.icon-btn-delete[_ngcontent-%COMP%]:hover{background:#ffebee}.row-actions[_ngcontent-%COMP%]{white-space:nowrap;text-align:right}.rent-actions[_ngcontent-%COMP%]{margin-top:.5rem}.btn-link[_ngcontent-%COMP%]{background:none;border:none;color:#007bff;cursor:pointer;padding:0;font-size:.9rem}.btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.warning-banner[_ngcontent-%COMP%]{background:#fff3cd;border:1px solid #ffc107;padding:.75rem;border-radius:4px;font-size:.875rem;margin-top:.75rem}.rent-form-panel[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:6px;padding:1.25rem;margin-top:1rem;background:#fff}.rent-form-panel[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1rem;font-weight:600}.current-read-only[_ngcontent-%COMP%]{display:flex;gap:.75rem;align-items:center;padding:.5rem .75rem;background:#f5f5f5;border-radius:4px;margin-bottom:1rem;font-size:.9rem;color:#555}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;margin-bottom:1rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:.45rem .6rem;border:1px solid #ccc;border-radius:4px;font-size:.9rem}.form-field[_ngcontent-%COMP%]   input.invalid[_ngcontent-%COMP%]{border-color:#c62828}.required[_ngcontent-%COMP%]{color:#d32f2f}.field-error[_ngcontent-%COMP%]{color:#d32f2f;font-size:.8rem}.change-preview[_ngcontent-%COMP%]{font-size:.85rem;font-weight:500}.notes-templates[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:.4rem}.tag[_ngcontent-%COMP%]{background:#e8f0fe;border:none;padding:.2rem .6rem;border-radius:12px;cursor:pointer;font-size:.8rem}.tag[_ngcontent-%COMP%]:hover{background:#c5cae9}.error-banner[_ngcontent-%COMP%]{background:#ffebee;color:#c62828;padding:.75rem;border-radius:4px;margin-bottom:.75rem;font-size:.875rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem}.history-panel[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:6px;padding:1.25rem;margin-top:1rem;background:#fff}.history-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.history-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:600}.btn-close[_ngcontent-%COMP%]{background:none;border:none;font-size:1.1rem;cursor:pointer;color:#555}.btn-close[_ngcontent-%COMP%]:hover{color:#000}.improvement-summary[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#f5f5f5;border-radius:6px;margin-bottom:1rem;font-size:.9rem;font-weight:500}.improvement-summary.improved[_ngcontent-%COMP%]{color:#2e7d32}.improvement-summary.degraded[_ngcontent-%COMP%]{color:#c62828}.history-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem}.history-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .history-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem .6rem;border-bottom:1px solid #e0e0e0;text-align:left}.history-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#fafafa;font-weight:600}.positive[_ngcontent-%COMP%]{color:#2e7d32}.negative[_ngcontent-%COMP%]{color:#c62828}.no-data[_ngcontent-%COMP%]{color:#888;font-style:italic}.loading[_ngcontent-%COMP%]{color:#888;padding:.5rem 0}.btn[_ngcontent-%COMP%]{padding:.45rem 1rem;border:none;border-radius:4px;cursor:pointer;font-size:.9rem}.btn-primary[_ngcontent-%COMP%]{background:#1976d2;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#1565c0}.btn-secondary[_ngcontent-%COMP%]{background:#e0e0e0;color:#333}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#bdbdbd}.btn-danger[_ngcontent-%COMP%]{background:#d32f2f;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#b71c1c}.btn-sm[_ngcontent-%COMP%]{padding:.3rem .7rem;font-size:.85rem}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:default}"]})}}return n})();const ut={LIVING_ROOM:"Living Room",BEDROOM:"Bedroom",KITCHEN:"Kitchen",BATHROOM:"Bathroom",TOILET:"Toilet",HALLWAY:"Hallway",STORAGE:"Storage",OFFICE:"Office",DINING_ROOM:"Dining Room",OTHER:"Other"},gt=["LIVING_ROOM","BEDROOM","KITCHEN","BATHROOM","TOILET","HALLWAY","STORAGE","OFFICE","DINING_ROOM","OTHER"];let ft=(()=>{class n{constructor(e){this.http=e,this.base=`${C.c.apiUrl}/housing-units`}getRooms(e){return this.http.get(`${this.base}/${e}/rooms`)}createRoom(e,i){return this.http.post(`${this.base}/${e}/rooms`,i)}updateRoom(e,i,o){return this.http.put(`${this.base}/${e}/rooms/${i}`,o)}deleteRoom(e,i){return this.http.delete(`${this.base}/${e}/rooms/${i}`)}batchCreateRooms(e,i){return this.http.post(`${this.base}/${e}/rooms/batch`,i)}static{this.\u0275fac=function(i){return new(i||n)(t.KVO(_.Qq))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function _t(n,r){1&n&&(t.j41(0,"div",12),t.EFF(1,"Loading rooms\u2026"),t.k0s())}function ht(n,r){if(1&n&&(t.j41(0,"div",13),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.JRh(e.errorMessage)}}function bt(n,r){if(1&n&&(t.j41(0,"div",14),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.successMessage," ")}}function vt(n,r){1&n&&(t.j41(0,"p",15),t.EFF(1," No rooms defined yet. "),t.k0s())}function Ct(n,r){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.nI1(5,"number"),t.k0s(),t.j41(6,"td",21)(7,"button",22),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.startEdit(o))}),t.EFF(8," \u270f\ufe0f "),t.k0s(),t.j41(9,"button",23),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.requestDelete(o))}),t.EFF(10," \u{1f5d1}\ufe0f "),t.k0s()(),t.bVm()}if(2&n){const e=t.XpG().$implicit,i=t.XpG(2);t.R7$(2),t.JRh(i.roomLabel(e.roomType)),t.R7$(2),t.JRh(t.i5U(5,4,e.approximateSurface,"1.2-2")),t.R7$(3),t.Y8G("disabled",i.saving),t.R7$(2),t.Y8G("disabled",i.saving)}}function Ft(n,r){if(1&n&&(t.j41(0,"option",29),t.EFF(1),t.k0s()),2&n){const e=r.$implicit,i=t.XpG(4);t.Y8G("value",e),t.R7$(),t.SpI(" ",i.roomLabel(e)," ")}}function Rt(n,r){1&n&&(t.j41(0,"span",30),t.EFF(1," Type is required "),t.k0s())}function kt(n,r){1&n&&(t.j41(0,"span",30),t.EFF(1," Surface must be between 0.01 and 999.99 "),t.k0s())}function yt(n,r){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"td")(2,"select",24),t.DNE(3,Ft,2,2,"option",25),t.k0s(),t.DNE(4,Rt,2,0,"span",26),t.k0s(),t.j41(5,"td"),t.nrm(6,"input",27),t.DNE(7,kt,2,0,"span",26),t.k0s(),t.j41(8,"td",21)(9,"button",28),t.bIt("click",function(){t.eBV(e);const o=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.saveEdit(o))}),t.EFF(10),t.k0s(),t.j41(11,"button",4),t.bIt("click",function(){t.eBV(e);const o=t.XpG(3);return t.Njj(o.cancelEdit())}),t.EFF(12," Cancel "),t.k0s()(),t.bVm()}if(2&n){const e=t.XpG(3);t.R7$(2),t.Y8G("formControl",e.editRoomType),t.R7$(),t.Y8G("ngForOf",e.allTypes),t.R7$(),t.Y8G("ngIf",e.editRoomType.invalid&&e.editRoomType.touched),t.R7$(2),t.Y8G("formControl",e.editApproximateSurface),t.R7$(),t.Y8G("ngIf",e.editApproximateSurface.invalid&&e.editApproximateSurface.touched),t.R7$(2),t.Y8G("disabled",e.saving),t.R7$(),t.SpI(" ",e.saving?"\u2026":"Save"," ")}}function Ot(n,r){if(1&n&&(t.j41(0,"tr"),t.DNE(1,Ct,11,7,"ng-container",20)(2,yt,13,7,"ng-container",20),t.k0s()),2&n){const e=r.$implicit,i=t.XpG(2);t.R7$(),t.Y8G("ngIf",i.editingRoomId!==e.id),t.R7$(),t.Y8G("ngIf",i.editingRoomId===e.id)}}function xt(n,r){if(1&n&&(t.j41(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),t.EFF(5,"Type"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Surface (m\xb2)"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Actions"),t.k0s()()(),t.j41(10,"tbody"),t.DNE(11,Ot,3,2,"tr",18),t.k0s(),t.j41(12,"tfoot")(13,"tr",19)(14,"td")(15,"strong"),t.EFF(16,"Total"),t.k0s()(),t.j41(17,"td")(18,"strong"),t.EFF(19),t.nI1(20,"number"),t.k0s()(),t.nrm(21,"td"),t.k0s()()()()),2&n){const e=t.XpG();t.R7$(11),t.Y8G("ngForOf",e.rooms),t.R7$(8),t.SpI("",t.i5U(20,2,e.totalSurface,"1.2-2")," m\xb2")}}function It(n,r){if(1&n&&(t.j41(0,"option",29),t.EFF(1),t.k0s()),2&n){const e=r.$implicit,i=t.XpG(2);t.Y8G("value",e),t.R7$(),t.SpI(" ",i.roomLabel(e)," ")}}function Et(n,r){1&n&&(t.j41(0,"span",30),t.EFF(1,"Type is required"),t.k0s())}function Pt(n,r){1&n&&(t.j41(0,"span",30),t.EFF(1," Surface must be between 0.01 and 999.99 "),t.k0s())}function Mt(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",31)(1,"h4"),t.EFF(2,"Add Room"),t.k0s(),t.j41(3,"form",32),t.bIt("ngSubmit",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.saveAdd())}),t.j41(4,"div",33)(5,"div",34)(6,"label"),t.EFF(7,"Type "),t.j41(8,"span",35),t.EFF(9,"*"),t.k0s()(),t.j41(10,"select",36)(11,"option",37),t.EFF(12,"\u2014 Select type \u2014"),t.k0s(),t.DNE(13,It,2,2,"option",25),t.k0s(),t.DNE(14,Et,2,0,"span",26),t.k0s(),t.j41(15,"div",34)(16,"label"),t.EFF(17,"Surface (m\xb2) "),t.j41(18,"span",35),t.EFF(19,"*"),t.k0s()(),t.nrm(20,"input",38),t.DNE(21,Pt,2,0,"span",26),t.k0s()(),t.j41(22,"div",39)(23,"button",40),t.EFF(24),t.k0s(),t.j41(25,"button",41),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.cancelAdd())}),t.EFF(26," Cancel "),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(3),t.Y8G("formGroup",e.addForm),t.R7$(7),t.AVh("invalid",e.isInvalidAdd("roomType")),t.R7$(3),t.Y8G("ngForOf",e.allTypes),t.R7$(),t.Y8G("ngIf",e.isInvalidAdd("roomType")),t.R7$(6),t.AVh("invalid",e.isInvalidAdd("approximateSurface")),t.R7$(),t.Y8G("ngIf",e.isInvalidAdd("approximateSurface")),t.R7$(2),t.Y8G("disabled",e.saving),t.R7$(),t.SpI(" ",e.saving?"Saving\u2026":"Save"," ")}}function St(n,r){if(1&n&&(t.j41(0,"div",49),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(e.quickError)}}function jt(n,r){if(1&n&&(t.j41(0,"option",29),t.EFF(1),t.k0s()),2&n){const e=r.$implicit,i=t.XpG(3);t.Y8G("value",e),t.R7$(),t.SpI(" ",i.roomLabel(e)," ")}}function $t(n,r){if(1&n){const e=t.RV6();t.j41(0,"tr",50)(1,"td")(2,"select",36)(3,"option",37),t.EFF(4,"\u2014 Select \u2014"),t.k0s(),t.DNE(5,jt,2,2,"option",25),t.k0s()(),t.j41(6,"td"),t.nrm(7,"input",51),t.k0s(),t.j41(8,"td")(9,"button",52),t.bIt("click",function(){const o=t.eBV(e).index,s=t.XpG(2);return t.Njj(s.removeQuickRow(o))}),t.EFF(10," \u2715 "),t.k0s()()()}if(2&n){const e=r.index,i=t.XpG(2);t.Y8G("formGroupName",e),t.R7$(2),t.AVh("invalid",i.isRowInvalid(e,"roomType")),t.R7$(3),t.Y8G("ngForOf",i.allTypes),t.R7$(2),t.AVh("invalid",i.isRowInvalid(e,"approximateSurface")),t.R7$(2),t.Y8G("disabled",i.quickRows.length<=1)}}function wt(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",31)(1,"h4"),t.EFF(2,"Quick Add Rooms"),t.k0s(),t.DNE(3,St,2,1,"div",42),t.j41(4,"form",32),t.bIt("ngSubmit",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.saveQuickAdd())}),t.j41(5,"table",43)(6,"thead")(7,"tr")(8,"th"),t.EFF(9,"Type"),t.k0s(),t.j41(10,"th"),t.EFF(11,"Surface (m\xb2)"),t.k0s(),t.nrm(12,"th"),t.k0s()(),t.j41(13,"tbody",44),t.DNE(14,$t,11,7,"tr",45),t.k0s()(),t.j41(15,"div",46)(16,"button",47),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.addQuickRow())}),t.EFF(17," + Add Row "),t.k0s(),t.j41(18,"span",48),t.EFF(19),t.k0s()(),t.j41(20,"div",39)(21,"button",40),t.EFF(22),t.k0s(),t.j41(23,"button",41),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.cancelQuickAdd())}),t.EFF(24," Cancel "),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(3),t.Y8G("ngIf",e.quickError),t.R7$(),t.Y8G("formGroup",e.quickForm),t.R7$(10),t.Y8G("ngForOf",e.quickRows.controls),t.R7$(2),t.Y8G("disabled",e.quickRows.length>=20),t.R7$(3),t.SpI("",e.quickRows.length," / 20 rows"),t.R7$(2),t.Y8G("disabled",e.saving),t.R7$(),t.SpI(" ",e.saving?"Saving\u2026":"Save All"," ")}}function Tt(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",53)(1,"div",54)(2,"h4"),t.EFF(3,"Delete this room?"),t.k0s(),t.j41(4,"p")(5,"strong"),t.EFF(6),t.k0s(),t.EFF(7),t.nI1(8,"number"),t.k0s(),t.j41(9,"p",55),t.EFF(10,"This action cannot be undone."),t.k0s(),t.j41(11,"div",56)(12,"button",57),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.cancelDelete())}),t.EFF(13," Cancel "),t.k0s(),t.j41(14,"button",58),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.confirmDelete())}),t.EFF(15),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(6),t.JRh(e.roomLabel(e.roomToDelete.roomType)),t.R7$(),t.SpI(" \u2014 ",t.i5U(8,4,e.roomToDelete.approximateSurface,"1.2-2")," m\xb2 "),t.R7$(7),t.Y8G("disabled",e.deleting),t.R7$(),t.SpI(" ",e.deleting?"Deleting\u2026":"Confirm"," ")}}let Gt=(()=>{class n{constructor(e,i){this.roomService=e,this.fb=i,this.rooms=[],this.totalSurface=0,this.loading=!1,this.saving=!1,this.deleting=!1,this.errorMessage="",this.successMessage="",this.showAddForm=!1,this.editingRoomId=null,this.roomToDelete=null,this.showQuickAdd=!1,this.quickError="",this.allTypes=gt,this.roomLabel=o=>ut[o]??o,this.destroy$=new p.B}ngOnInit(){this.buildForms(),this.loadRooms()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}get editRoomType(){return this.editForm.get("roomType")}get editApproximateSurface(){return this.editForm.get("approximateSurface")}loadRooms(){this.loading=!0,this.errorMessage="",this.roomService.getRooms(this.unitId).pipe((0,d.Q)(this.destroy$)).subscribe({next:e=>{this.rooms=e.rooms,this.totalSurface=e.totalSurface??0,this.loading=!1},error:()=>{this.errorMessage="Failed to load rooms.",this.loading=!1}})}buildForms(){this.addForm=this.fb.group({roomType:["",a.k0.required],approximateSurface:[null,[a.k0.required,a.k0.min(.01),a.k0.max(999.99)]]}),this.editForm=this.fb.group({roomType:["",a.k0.required],approximateSurface:[null,[a.k0.required,a.k0.min(.01),a.k0.max(999.99)]]}),this.quickForm=this.fb.group({rows:this.fb.array([this.buildQuickRow(),this.buildQuickRow(),this.buildQuickRow()])})}buildQuickRow(){return this.fb.group({roomType:[""],approximateSurface:[null]})}get quickRows(){return this.quickForm.get("rows")}openAddForm(){this.showAddForm=!0,this.showQuickAdd=!1,this.cancelEdit(),this.addForm.reset(),this.clearMessages()}cancelAdd(){this.showAddForm=!1,this.addForm.reset()}isInvalidAdd(e){const i=this.addForm.get(e);return!!(i&&i.invalid&&i.touched)}saveAdd(){if(this.addForm.markAllAsTouched(),this.addForm.invalid)return;this.saving=!0,this.clearMessages();const{roomType:e,approximateSurface:i}=this.addForm.value;this.roomService.createRoom(this.unitId,{roomType:e,approximateSurface:i}).pipe((0,d.Q)(this.destroy$)).subscribe({next:()=>{this.saving=!1,this.showAddForm=!1,this.addForm.reset(),this.showSuccess("Room added successfully."),this.loadRooms()},error:o=>{this.saving=!1,this.errorMessage=o.error?.message??"Failed to add room."}})}startEdit(e){this.editingRoomId=e.id,this.editForm.patchValue({roomType:e.roomType,approximateSurface:e.approximateSurface}),this.showAddForm=!1,this.showQuickAdd=!1,this.clearMessages()}cancelEdit(){this.editingRoomId=null,this.editForm.reset()}saveEdit(e){if(this.editForm.markAllAsTouched(),this.editForm.invalid)return;this.saving=!0,this.clearMessages();const{roomType:i,approximateSurface:o}=this.editForm.value;this.roomService.updateRoom(this.unitId,e.id,{roomType:i,approximateSurface:o}).pipe((0,d.Q)(this.destroy$)).subscribe({next:()=>{this.saving=!1,this.editingRoomId=null,this.showSuccess("Room updated successfully."),this.loadRooms()},error:s=>{this.saving=!1,this.errorMessage=s.error?.message??"Failed to update room."}})}requestDelete(e){this.roomToDelete=e,this.cancelEdit(),this.clearMessages()}cancelDelete(){this.roomToDelete=null}confirmDelete(){this.roomToDelete&&(this.deleting=!0,this.roomService.deleteRoom(this.unitId,this.roomToDelete.id).pipe((0,d.Q)(this.destroy$)).subscribe({next:()=>{this.deleting=!1,this.roomToDelete=null,this.showSuccess("Room deleted successfully."),this.loadRooms()},error:e=>{this.deleting=!1,this.roomToDelete=null,this.errorMessage=e.error?.message??"Failed to delete room."}}))}openQuickAdd(){for(this.showQuickAdd=!0,this.showAddForm=!1,this.cancelEdit(),this.clearMessages(),this.quickError="";this.quickRows.length>0;)this.quickRows.removeAt(0);for(let e=0;e<3;e++)this.quickRows.push(this.buildQuickRow())}cancelQuickAdd(){this.showQuickAdd=!1,this.quickError=""}addQuickRow(){this.quickRows.length<20&&this.quickRows.push(this.buildQuickRow())}removeQuickRow(e){this.quickRows.length>1&&this.quickRows.removeAt(e)}isRowInvalid(e,i){const s=this.quickRows.at(e).get(i);return!(!s||!s.invalid||!s.touched&&!this.saving)}saveQuickAdd(){this.quickError="";const e=[];let i=!1;for(let o=0;o<this.quickRows.length;o++){const s=this.quickRows.at(o),{roomType:u,approximateSurface:m}=s.value;if(u||null!==m){if(!u||null===m||m<=0||m>=1e3){s.markAllAsTouched(),i=!0;continue}e.push({roomType:u,approximateSurface:Number(m)})}}i?this.quickError="Some rows have invalid data. Please fix them or remove the rows.":0!==e.length?(this.saving=!0,this.roomService.batchCreateRooms(this.unitId,{rooms:e}).pipe((0,d.Q)(this.destroy$)).subscribe({next:o=>{this.saving=!1,this.showQuickAdd=!1,this.showSuccess(`${o.length} room(s) added successfully.`),this.loadRooms()},error:o=>{this.saving=!1,this.quickError=o.error?.message??"Failed to save rooms."}})):this.quickError="Please fill in at least one room."}showSuccess(e){this.successMessage=e,setTimeout(()=>this.successMessage="",4e3)}clearMessages(){this.errorMessage="",this.successMessage=""}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(ft),t.rXU(a.ok))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-room-section"]],inputs:{unitId:"unitId"},standalone:!0,features:[t.aNF],decls:17,vars:8,consts:[[1,"room-section"],[1,"section-header"],[1,"header-actions"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"btn","btn-sm","btn-secondary",3,"click"],["class","loading",4,"ngIf"],["class","error-banner",4,"ngIf"],["class","success-banner",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","table-wrapper",4,"ngIf"],["class","form-card",4,"ngIf"],["class","dialog-overlay",4,"ngIf"],[1,"loading"],[1,"error-banner"],[1,"success-banner"],[1,"empty-state"],[1,"table-wrapper"],[1,"rooms-table"],[4,"ngFor","ngForOf"],[1,"total-row"],[4,"ngIf"],[1,"actions"],["title","Edit",1,"btn-icon",3,"click","disabled"],["title","Delete",1,"btn-icon",3,"click","disabled"],[1,"select-inline",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["class","field-error",4,"ngIf"],["type","number","min","0.01","max","999.99","step","0.01",1,"input-inline",3,"formControl"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],[3,"value"],[1,"field-error"],[1,"form-card"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-field"],[1,"required"],["formControlName","roomType"],["value",""],["type","number","formControlName","approximateSurface","min","0.01","max","999.99","step","0.01","placeholder","e.g. 15.50"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],["type","button",1,"btn","btn-secondary",3,"click"],["class","form-error",4,"ngIf"],[1,"quick-table"],["formArrayName","rows"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"quick-footer"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click","disabled"],[1,"row-count"],[1,"form-error"],[3,"formGroupName"],["type","number","formControlName","approximateSurface","min","0.01","max","999.99","step","0.01","placeholder","m\xb2"],["type","button","title","Remove row",1,"btn-icon",3,"click","disabled"],[1,"dialog-overlay"],[1,"dialog"],[1,"warning"],[1,"dialog-actions"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"click","disabled"]],template:function(i,o){1&i&&(t.j41(0,"section",0)(1,"div",1)(2,"h3"),t.EFF(3,"Rooms"),t.k0s(),t.j41(4,"div",2)(5,"button",3),t.bIt("click",function(){return o.openAddForm()}),t.EFF(6," Add Room "),t.k0s(),t.j41(7,"button",4),t.bIt("click",function(){return o.openQuickAdd()}),t.EFF(8," Quick Add "),t.k0s()()(),t.DNE(9,_t,2,0,"div",5)(10,ht,2,1,"div",6)(11,bt,2,1,"div",7)(12,vt,2,0,"p",8)(13,xt,22,5,"div",9)(14,Mt,27,10,"div",10)(15,wt,25,7,"div",10)(16,Tt,16,7,"div",11),t.k0s()),2&i&&(t.R7$(9),t.Y8G("ngIf",o.loading),t.R7$(),t.Y8G("ngIf",o.errorMessage),t.R7$(),t.Y8G("ngIf",o.successMessage),t.R7$(),t.Y8G("ngIf",!o.loading&&0===o.rooms.length&&!o.showAddForm&&!o.showQuickAdd),t.R7$(),t.Y8G("ngIf",o.rooms.length>0||null!==o.editingRoomId),t.R7$(),t.Y8G("ngIf",o.showAddForm),t.R7$(),t.Y8G("ngIf",o.showQuickAdd),t.R7$(),t.Y8G("ngIf",o.roomToDelete))},dependencies:[c.MD,c.Sq,c.bT,c.QX,a.X1,a.qT,a.xH,a.y7,a.me,a.Q0,a.wz,a.BC,a.cb,a.VZ,a.zX,a.l_,a.j4,a.JD,a.$R,a.v8],styles:[".room-section[_ngcontent-%COMP%]{margin-top:1rem}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.rooms-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.95rem}.rooms-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .rooms-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem .75rem;border-bottom:1px solid #e0e0e0;text-align:left}.rooms-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f5f5f5;font-weight:600}.total-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:2px solid #ccc;border-bottom:none}.actions[_ngcontent-%COMP%]{display:flex;gap:.4rem;white-space:nowrap}.select-inline[_ngcontent-%COMP%], .input-inline[_ngcontent-%COMP%]{padding:.3rem .5rem;border:1px solid #ccc;border-radius:4px;font-size:.9rem;width:100%}.quick-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-bottom:.75rem}.quick-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .quick-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.4rem .5rem}.quick-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;font-size:.85rem;color:#555}.quick-table[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .quick-table[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:100%;padding:.3rem .5rem;border:1px solid #ccc;border-radius:4px}.quick-table[_ngcontent-%COMP%]   .invalid[_ngcontent-%COMP%]{border-color:#c62828}.quick-footer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:.75rem}.row-count[_ngcontent-%COMP%]{font-size:.85rem;color:#888}.form-card[_ngcontent-%COMP%]{background:#f9f9f9;border:1px solid #e0e0e0;border-radius:6px;padding:1rem;margin-top:.5rem}.form-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;flex:1;min-width:150px}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem}.form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.4rem .6rem;border:1px solid #ccc;border-radius:4px;font-size:.95rem}.form-field[_ngcontent-%COMP%]   select.invalid[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   input.invalid[_ngcontent-%COMP%]{border-color:#c62828}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.75rem}.btn[_ngcontent-%COMP%]{padding:.4rem .9rem;border:none;border-radius:4px;cursor:pointer;font-size:.9rem}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#545b62}.btn-danger[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#a71d2a}.btn-sm[_ngcontent-%COMP%]{padding:.3rem .65rem;font-size:.85rem}.btn-icon[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1rem;padding:.1rem .3rem}.btn-icon[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.empty-state[_ngcontent-%COMP%]{color:#888;font-style:italic}.loading[_ngcontent-%COMP%]{color:#555;padding:.5rem 0}.required[_ngcontent-%COMP%]{color:#c62828}.field-error[_ngcontent-%COMP%]{color:#c62828;font-size:.8rem}.form-error[_ngcontent-%COMP%]{color:#c62828;font-size:.9rem;margin-bottom:.5rem}.error-banner[_ngcontent-%COMP%]{background:#fdecea;border:1px solid #f5c6cb;border-radius:4px;padding:.5rem .75rem;color:#721c24;margin-bottom:.5rem}.success-banner[_ngcontent-%COMP%]{background:#d4edda;border:1px solid #c3e6cb;border-radius:4px;padding:.5rem .75rem;color:#155724;margin-bottom:.5rem}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;align-items:center;justify-content:center;z-index:1000}.dialog[_ngcontent-%COMP%]{background:#fff;border-radius:8px;padding:1.5rem;max-width:380px;width:90%}.dialog[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem}.dialog[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{color:#c62828;font-size:.9rem}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem;justify-content:flex-end}"]})}}return n})();var Dt=l(2304);const Nt=n=>["/buildings",n];function Yt(n,r){if(1&n&&(t.j41(0,"div")(1,"label"),t.EFF(2,"Landing"),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.JRh(e.unit.landingNumber)}}function Xt(n,r){if(1&n&&(t.j41(0,"div")(1,"label"),t.EFF(2,"Total Surface"),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI("",e.unit.totalSurface," m\xb2")}}function At(n,r){if(1&n&&(t.j41(0,"div")(1,"label"),t.EFF(2,"Terrace"),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.Lme(" ",e.unit.terraceSurface?e.unit.terraceSurface+" m\xb2":"\u2014"," ",e.unit.terraceOrientation?" \xb7 "+e.unit.terraceOrientation:""," ")}}function Vt(n,r){if(1&n&&(t.j41(0,"div")(1,"label"),t.EFF(2,"Garden"),t.k0s(),t.j41(3,"span"),t.EFF(4),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.Lme(" ",e.unit.gardenSurface?e.unit.gardenSurface+" m\xb2":"\u2014"," ",e.unit.gardenOrientation?" \xb7 "+e.unit.gardenOrientation:""," ")}}function Ht(n,r){if(1&n&&(t.j41(0,"section"),t.nrm(1,"app-meter-section",11),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("ownerType","HOUSING_UNIT")("ownerId",e.unit.id)}}function qt(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div")(3,"a",3),t.EFF(4),t.k0s(),t.j41(5,"span",4),t.EFF(6,"\u203a"),t.k0s(),t.j41(7,"h2"),t.EFF(8),t.k0s()(),t.j41(9,"div",5)(10,"button",6),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.edit())}),t.EFF(11,"Edit"),t.k0s(),t.j41(12,"button",7),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.confirmDelete())}),t.EFF(13,"Delete"),t.k0s()()(),t.j41(14,"section")(15,"h3"),t.EFF(16,"Information"),t.k0s(),t.j41(17,"div",8)(18,"div")(19,"label"),t.EFF(20,"Unit Number"),t.k0s(),t.j41(21,"span"),t.EFF(22),t.k0s()(),t.j41(23,"div")(24,"label"),t.EFF(25,"Floor"),t.k0s(),t.j41(26,"span"),t.EFF(27),t.k0s()(),t.DNE(28,Yt,5,1,"div",9)(29,Xt,5,1,"div",9),t.j41(30,"div")(31,"label"),t.EFF(32,"Owner"),t.k0s(),t.j41(33,"span"),t.EFF(34),t.k0s()(),t.DNE(35,At,5,2,"div",9)(36,Vt,5,2,"div",9),t.k0s()(),t.j41(37,"section"),t.nrm(38,"app-room-section",10),t.k0s(),t.j41(39,"section"),t.nrm(40,"app-peb-section",10),t.k0s(),t.j41(41,"section"),t.nrm(42,"app-rent-section",10),t.k0s(),t.DNE(43,Ht,2,2,"section",9),t.k0s()}if(2&n){let e;const i=t.XpG();t.R7$(3),t.Y8G("routerLink",t.eq3(14,Nt,i.unit.buildingId)),t.R7$(),t.JRh(i.unit.buildingName),t.R7$(4),t.SpI("Unit ",i.unit.unitNumber,""),t.R7$(14),t.JRh(i.unit.unitNumber),t.R7$(5),t.JRh(i.unit.floor),t.R7$(),t.Y8G("ngIf",i.unit.landingNumber),t.R7$(),t.Y8G("ngIf",i.unit.totalSurface),t.R7$(5),t.JRh(null!==(e=i.unit.ownerName)&&void 0!==e?e:"\u2014"),t.R7$(),t.Y8G("ngIf",i.unit.hasTerrace),t.R7$(),t.Y8G("ngIf",i.unit.hasGarden),t.R7$(2),t.Y8G("unitId",i.unit.id),t.R7$(2),t.Y8G("unitId",i.unit.id),t.R7$(2),t.Y8G("unitId",i.unit.id),t.R7$(),t.Y8G("ngIf",i.unit)}}let Bt=(()=>{class n{constructor(e,i,o){this.route=e,this.router=i,this.housingUnitService=o,this.loading=!1,this.showDeleteConfirm=!1,this.deleting=!1,this.deleteError="",this.destroy$=new p.B}ngOnInit(){const e=+(this.route.snapshot.paramMap.get("id")??0);e&&(this.loading=!0,this.housingUnitService.getUnitById(e).pipe((0,d.Q)(this.destroy$)).subscribe({next:i=>{this.unit=i,this.loading=!1},error:()=>{this.loading=!1}}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}edit(){this.unit&&this.router.navigate(["/units",this.unit.id,"edit"])}confirmDelete(){this.showDeleteConfirm=!0}delete(){this.unit&&(this.deleting=!0,this.housingUnitService.delete(this.unit.id).pipe((0,d.Q)(this.destroy$)).subscribe({next:()=>{this.router.navigate(["/buildings",this.unit.buildingId])},error:e=>{this.deleting=!1,this.deleteError=e.error?.message??"Failed to delete unit."}}))}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(g.nX),t.rXU(g.Ix),t.rXU(Dt.J))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-housing-unit-details"]],standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[["class","details-container",4,"ngIf"],[1,"details-container"],[1,"details-header"],[1,"breadcrumb",3,"routerLink"],[1,"separator"],[1,"header-actions"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"click"],[1,"info-grid"],[4,"ngIf"],[3,"unitId"],[3,"ownerType","ownerId"]],template:function(i,o){1&i&&t.DNE(0,qt,44,16,"div",0),2&i&&t.Y8G("ngIf",o.unit)},dependencies:[c.MD,c.bT,g.Wk,Gt,B,pt,F.q],styles:[".details-container[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:0 1rem}.details-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem}.details-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]{color:#007bff;text-decoration:none;font-size:.9rem}.details-header[_ngcontent-%COMP%]   .breadcrumb[_ngcontent-%COMP%]:hover{text-decoration:underline}.details-header[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{margin:0 .5rem;color:#888}.details-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:.25rem 0 0;font-size:1.5rem;color:#333}.details-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}section[_ngcontent-%COMP%]{margin-bottom:1.5rem;border:1px solid #e0e0e0;border-radius:6px;padding:1rem 1.5rem;background:#fff}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}h3[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.1rem;color:#444}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:.75rem 1.5rem}.info-grid[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#666;font-size:.8rem;text-transform:uppercase;letter-spacing:.4px;display:block;margin-bottom:.1rem}.placeholder-text[_ngcontent-%COMP%]{color:#aaa;font-style:italic;margin:.5rem 0 0}.loading[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#666}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border:none;border-radius:4px;font-size:.9rem;cursor:pointer;transition:background .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#5a6268}.btn.btn-danger[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#c82333}.btn.btn-sm[_ngcontent-%COMP%]{padding:.25rem .6rem;font-size:.8rem}.dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;align-items:center;justify-content:center;z-index:1000}.dialog[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;max-width:440px;width:90%}.dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem}.dialog[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%]{color:#c00;font-weight:500}.dialog[_ngcontent-%COMP%]   .dialog-error[_ngcontent-%COMP%]{color:#dc3545;margin-bottom:.5rem;font-size:.9rem}.dialog[_ngcontent-%COMP%]   .dialog-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:1.5rem}"]})}}return n})()}}]);