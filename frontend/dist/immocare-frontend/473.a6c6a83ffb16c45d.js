"use strict";(self.webpackChunkimmocare_frontend=self.webpackChunkimmocare_frontend||[]).push([[473],{7473:(x,d,l)=>{l.r(d),l.d(d,{UserFormComponent:()=>k});var m=l(177),s=l(4341),r=l(4438),f=l(3443),c=l(7282);function u(o,i){1&o&&(r.j41(0,"div",3),r.EFF(1,"Loading\u2026"),r.k0s())}function p(o,i){if(1&o&&(r.j41(0,"div",20),r.EFF(1),r.k0s()),2&o){const e=r.XpG(2);r.R7$(),r.JRh(e.errorMessage)}}function _(o,i){if(1&o&&(r.j41(0,"span",21),r.EFF(1),r.k0s()),2&o){const e=r.XpG(2);r.R7$(),r.JRh(e.fieldError("username"))}}function g(o,i){if(1&o&&(r.j41(0,"span",21),r.EFF(1),r.k0s()),2&o){const e=r.XpG(2);r.R7$(),r.JRh(e.fieldError("email"))}}function h(o,i){if(1&o&&(r.j41(0,"span",21),r.EFF(1),r.k0s()),2&o){const e=r.XpG(3);r.R7$(),r.JRh(e.fieldError("password"))}}function b(o,i){1&o&&(r.j41(0,"span",21),r.EFF(1,"Passwords do not match"),r.k0s())}function E(o,i){if(1&o&&(r.j41(0,"span",21),r.EFF(1),r.k0s()),2&o){const e=r.XpG(3);r.R7$(),r.JRh(e.fieldError("confirmPassword"))}}function F(o,i){if(1&o&&(r.qex(0),r.j41(1,"div",6)(2,"label",22),r.EFF(3,"Password "),r.j41(4,"span",8),r.EFF(5,"*"),r.k0s()(),r.nrm(6,"input",23),r.DNE(7,h,2,1,"span",10),r.k0s(),r.j41(8,"div",6)(9,"label",24),r.EFF(10,"Confirm Password "),r.j41(11,"span",8),r.EFF(12,"*"),r.k0s()(),r.nrm(13,"input",25),r.DNE(14,b,2,0,"span",10)(15,E,2,1,"span",10),r.k0s(),r.bVm()),2&o){let e,t;const n=r.XpG(2);r.R7$(6),r.AVh("invalid",(null==(e=n.form.get("password"))?null:e.invalid)&&(null==(e=n.form.get("password"))?null:e.touched)),r.R7$(),r.Y8G("ngIf",n.fieldError("password")),r.R7$(6),r.AVh("invalid",(null==(t=n.form.get("confirmPassword"))?null:t.invalid)&&(null==(t=n.form.get("confirmPassword"))?null:t.touched)||n.passwordMismatch),r.R7$(),r.Y8G("ngIf",n.passwordMismatch),r.R7$(),r.Y8G("ngIf",!n.passwordMismatch&&n.fieldError("confirmPassword"))}}function C(o,i){if(1&o&&(r.j41(0,"option",26),r.EFF(1),r.k0s()),2&o){const e=i.$implicit;r.Y8G("value",e),r.R7$(),r.JRh(e)}}function v(o,i){if(1&o&&(r.j41(0,"span",21),r.EFF(1),r.k0s()),2&o){const e=r.XpG(2);r.R7$(),r.JRh(e.fieldError("role"))}}function M(o,i){if(1&o){const e=r.RV6();r.j41(0,"form",4),r.bIt("ngSubmit",function(){r.eBV(e);const n=r.XpG();return r.Njj(n.submit())}),r.DNE(1,p,2,1,"div",5),r.j41(2,"div",6)(3,"label",7),r.EFF(4,"Username "),r.j41(5,"span",8),r.EFF(6,"*"),r.k0s()(),r.nrm(7,"input",9),r.DNE(8,_,2,1,"span",10),r.k0s(),r.j41(9,"div",6)(10,"label",11),r.EFF(11,"Email "),r.j41(12,"span",8),r.EFF(13,"*"),r.k0s()(),r.nrm(14,"input",12),r.DNE(15,g,2,1,"span",10),r.k0s(),r.DNE(16,F,16,7,"ng-container",13),r.j41(17,"div",6)(18,"label",14),r.EFF(19,"Role "),r.j41(20,"span",8),r.EFF(21,"*"),r.k0s()(),r.j41(22,"select",15),r.DNE(23,C,2,2,"option",16),r.k0s(),r.DNE(24,v,2,1,"span",10),r.k0s(),r.j41(25,"div",17)(26,"button",18),r.EFF(27),r.k0s(),r.j41(28,"button",19),r.bIt("click",function(){r.eBV(e);const n=r.XpG();return r.Njj(n.cancel())}),r.EFF(29,"Cancel"),r.k0s()()()}if(2&o){let e,t,n;const a=r.XpG();r.Y8G("formGroup",a.form),r.R7$(),r.Y8G("ngIf",a.errorMessage),r.R7$(6),r.AVh("invalid",(null==(e=a.form.get("username"))?null:e.invalid)&&(null==(e=a.form.get("username"))?null:e.touched)),r.R7$(),r.Y8G("ngIf",a.fieldError("username")),r.R7$(6),r.AVh("invalid",(null==(t=a.form.get("email"))?null:t.invalid)&&(null==(t=a.form.get("email"))?null:t.touched)),r.R7$(),r.Y8G("ngIf",a.fieldError("email")),r.R7$(),r.Y8G("ngIf",!a.isEdit),r.R7$(6),r.AVh("invalid",(null==(n=a.form.get("role"))?null:n.invalid)&&(null==(n=a.form.get("role"))?null:n.touched)),r.R7$(),r.Y8G("ngForOf",a.roles),r.R7$(),r.Y8G("ngIf",a.fieldError("role")),r.R7$(2),r.Y8G("disabled",a.submitting),r.R7$(),r.SpI(" ",a.submitting?"Saving\u2026":"Save"," ")}}function P(o){const i=o.value;return i?/(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}/.test(i)?null:{complexity:"Must contain at least one uppercase letter, one lowercase letter, and one digit"}:null}function w(o){const i=o.get("password")?.value,e=o.get("confirmPassword")?.value;return i&&e&&i!==e?{passwordsMismatch:!0}:null}let k=(()=>{class o{constructor(e,t,n,a){this.fb=e,this.userService=t,this.router=n,this.route=a,this.isEdit=!1,this.loading=!1,this.submitting=!1,this.errorMessage="",this.isDirty=!1,this.roles=["ADMIN"]}ngOnInit(){const e=this.route.snapshot.paramMap.get("id");this.isEdit=!!e&&"new"!==e,this.buildForm(),this.isEdit&&(this.userId=Number(e),this.loading=!0,this.userService.getById(this.userId).subscribe({next:t=>{this.patchForm(t),this.loading=!1,setTimeout(()=>this.form.markAsPristine())},error:()=>{this.errorMessage="Failed to load user.",this.loading=!1}})),this.form.valueChanges.subscribe(()=>{this.isDirty=this.form.dirty})}buildForm(){this.form=this.fb.group({username:["",[s.k0.required,s.k0.minLength(3),s.k0.maxLength(50),s.k0.pattern("^[a-zA-Z0-9_]+$")]],email:["",[s.k0.required,s.k0.email,s.k0.maxLength(100)]],password:["",this.isEdit?[]:[s.k0.required,s.k0.minLength(8),P]],confirmPassword:["",this.isEdit?[]:[s.k0.required]],role:["ADMIN",s.k0.required]},{validators:this.isEdit?[]:[w]}),this.isEdit&&(this.form.removeControl("password"),this.form.removeControl("confirmPassword"))}patchForm(e){this.form.patchValue({username:e.username,email:e.email,role:e.role})}get f(){return this.form.controls}fieldError(e){const t=this.form.get(e);return t&&t.invalid&&t.touched?t.errors?.required?`${e} is required`:t.errors?.minlength?`${e} is too short`:t.errors?.maxlength?`${e} is too long`:t.errors?.email?"Email must be valid":t.errors?.pattern?"Only letters, digits, and underscores allowed":t.errors?.complexity?t.errors.complexity:"":""}get passwordMismatch(){return!this.isEdit&&this.form.hasError("passwordsMismatch")&&!!this.form.get("confirmPassword")?.touched}submit(){if(this.form.markAllAsTouched(),this.form.invalid)return;this.submitting=!0,this.errorMessage="";const e=this.form.value;(this.isEdit&&null!=this.userId?this.userService.update(this.userId,{username:e.username,email:e.email,role:e.role}):this.userService.create({username:e.username,email:e.email,password:e.password,confirmPassword:e.confirmPassword,role:e.role})).subscribe({next:n=>{this.submitting=!1,this.form.markAsPristine(),this.router.navigate(["/users",n.id])},error:n=>{this.submitting=!1,this.errorMessage=n.error?.message??"An error occurred."}})}cancel(){this.isDirty&&!confirm("You have unsaved changes. Are you sure you want to cancel?")||this.router.navigate(["/users"])}static{this.\u0275fac=function(t){return new(t||o)(r.rXU(s.ok),r.rXU(f.D),r.rXU(c.Ix),r.rXU(c.nX))}}static{this.\u0275cmp=r.VBU({type:o,selectors:[["app-user-form"]],standalone:!0,features:[r.aNF],decls:5,vars:3,consts:[[1,"user-form"],["class","loading",4,"ngIf"],["novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading"],["novalidate","",3,"ngSubmit","formGroup"],["class","alert alert--error",4,"ngIf"],[1,"form-field"],["for","username"],[1,"required"],["id","username","type","text","formControlName","username","placeholder","e.g. john_doe"],["class","field-error",4,"ngIf"],["for","email"],["id","email","type","email","formControlName","email","placeholder","e.g. john@example.com"],[4,"ngIf"],["for","role"],["id","role","formControlName","role"],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["type","submit",1,"btn","btn--primary",3,"disabled"],["type","button",1,"btn","btn--secondary",3,"click"],[1,"alert","alert--error"],[1,"field-error"],["for","password"],["id","password","type","password","formControlName","password","placeholder","Min. 8 chars, 1 upper, 1 lower, 1 digit"],["for","confirmPassword"],["id","confirmPassword","type","password","formControlName","confirmPassword","placeholder","Repeat password"],[3,"value"]],template:function(t,n){1&t&&(r.j41(0,"div",0)(1,"h1"),r.EFF(2),r.k0s(),r.DNE(3,u,2,0,"div",1)(4,M,30,15,"form",2),r.k0s()),2&t&&(r.R7$(2),r.JRh(n.isEdit?"Edit User":"Create User"),r.R7$(),r.Y8G("ngIf",n.loading),r.R7$(),r.Y8G("ngIf",!n.loading))},dependencies:[m.MD,m.Sq,m.bT,s.X1,s.qT,s.xH,s.y7,s.me,s.wz,s.BC,s.cb,s.j4,s.JD],styles:[".user-form[_ngcontent-%COMP%]{max-width:560px;padding:1.5rem}.user-form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:1.5rem;font-size:1.5rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:1.25rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.35rem;color:#374151;font-size:.9rem}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.55rem .75rem;border:1px solid #d1d5db;border-radius:6px;font-size:.9rem;outline:none;transition:border-color .15s}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#2563eb;box-shadow:0 0 0 3px #2563eb26}.form-field[_ngcontent-%COMP%]   input.invalid[_ngcontent-%COMP%], .form-field[_ngcontent-%COMP%]   select.invalid[_ngcontent-%COMP%]{border-color:#dc2626}.required[_ngcontent-%COMP%]{color:#dc2626;margin-left:2px}.field-error[_ngcontent-%COMP%]{color:#dc2626;font-size:.8rem;margin-top:.25rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:1.5rem}.btn[_ngcontent-%COMP%]{padding:.55rem 1.25rem;border-radius:6px;border:1px solid transparent;cursor:pointer;font-size:.875rem;font-weight:500}.btn--primary[_ngcontent-%COMP%]{background:#2563eb;color:#fff;border-color:#2563eb}.btn--primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#1d4ed8}.btn--secondary[_ngcontent-%COMP%]{background:#fff;color:#374151;border-color:#d1d5db}.btn--secondary[_ngcontent-%COMP%]:hover{background:#f9fafb}.btn[_ngcontent-%COMP%]:disabled{opacity:.45;cursor:not-allowed}.alert--error[_ngcontent-%COMP%]{padding:.75rem 1rem;background:#fef2f2;color:#dc2626;border:1px solid #fecaca;border-radius:6px;margin-bottom:1.25rem}.loading[_ngcontent-%COMP%]{color:#6b7280;padding:2rem 0}"]})}}return o})()}}]);