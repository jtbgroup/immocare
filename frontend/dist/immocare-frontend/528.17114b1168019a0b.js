"use strict";(self.webpackChunkimmocare_frontend=self.webpackChunkimmocare_frontend||[]).push([[528],{2304:(v,m,c)=>{c.d(m,{J:()=>g});var _=c(5312),a=c(4438),u=c(1626);let g=(()=>{class d{constructor(l){this.http=l,this.baseUrl=`${_.c.apiUrl}`}getUnitsByBuilding(l){return this.http.get(`${this.baseUrl}/buildings/${l}/units`)}getUnitById(l){return this.http.get(`${this.baseUrl}/units/${l}`)}create(l){return this.http.post(`${this.baseUrl}/units`,l)}update(l,p){return this.http.put(`${this.baseUrl}/units/${l}`,p)}delete(l){return this.http.delete(`${this.baseUrl}/units/${l}`)}static{this.\u0275fac=function(p){return new(p||d)(a.KVO(u.Qq))}}static{this.\u0275prov=a.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},6238:(v,m,c)=>{c.d(m,{o:()=>_,q:()=>a});const _={A_PLUS_PLUS:{label:"A++",color:"#1a7a1a",textColor:"#fff"},A_PLUS:{label:"A+",color:"#2d9e2d",textColor:"#fff"},A:{label:"A",color:"#4caf50",textColor:"#fff"},B:{label:"B",color:"#8bc34a",textColor:"#333"},C:{label:"C",color:"#ffeb3b",textColor:"#333"},D:{label:"D",color:"#ff9800",textColor:"#fff"},E:{label:"E",color:"#f44336",textColor:"#fff"},F:{label:"F",color:"#d32f2f",textColor:"#fff"},G:{label:"G",color:"#7b1fa2",textColor:"#fff"}},a=["A_PLUS_PLUS","A_PLUS","A","B","C","D","E","F","G"]},9674:(v,m,c)=>{c.d(m,{q:()=>ie});var _=c(177),a=c(4341);const u={WATER:"Water",GAS:"Gas",ELECTRICITY:"Electricity"},g={WATER:"water_drop",GAS:"local_fire_department",ELECTRICITY:"bolt"},d={BROKEN:"Broken",END_OF_LIFE:"End of life",UPGRADE:"Upgrade",CALIBRATION_ISSUE:"Calibration issue",OTHER:"Other"},f=["WATER","GAS","ELECTRICITY"],l=["BROKEN","END_OF_LIFE","UPGRADE","CALIBRATION_ISSUE","OTHER"];function p(n){const o=new Date(n.startDate),t=n.endDate?new Date(n.endDate):new Date;return 12*(t.getFullYear()-o.getFullYear())+(t.getMonth()-o.getMonth())}var e=c(4438),h=c(1626);let b=(()=>{class n{constructor(t){this.http=t,this.api="/api/v1"}getUnitMeterHistory(t){return this.http.get(`${this.api}/housing-units/${t}/meters`)}getUnitActiveMeters(t){const i=(new h.Nl).set("status","active");return this.http.get(`${this.api}/housing-units/${t}/meters`,{params:i})}addUnitMeter(t,i){return this.http.post(`${this.api}/housing-units/${t}/meters`,i)}replaceUnitMeter(t,i,r){return this.http.put(`${this.api}/housing-units/${t}/meters/${i}/replace`,r)}removeUnitMeter(t,i,r){return this.http.delete(`${this.api}/housing-units/${t}/meters/${i}`,{body:r})}getBuildingMeterHistory(t){return this.http.get(`${this.api}/buildings/${t}/meters`)}getBuildingActiveMeters(t){const i=(new h.Nl).set("status","active");return this.http.get(`${this.api}/buildings/${t}/meters`,{params:i})}addBuildingMeter(t,i){return this.http.post(`${this.api}/buildings/${t}/meters`,i)}replaceBuildingMeter(t,i,r){return this.http.put(`${this.api}/buildings/${t}/meters/${i}/replace`,r)}removeBuildingMeter(t,i,r){return this.http.delete(`${this.api}/buildings/${t}/meters/${i}`,{body:r})}static{this.\u0275fac=function(i){return new(i||n)(e.KVO(h.Qq))}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function E(n,o){if(1&n&&(e.j41(0,"div",12),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.successMessage)}}function F(n,o){if(1&n&&(e.j41(0,"div",13),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.SpI(" ",t.errorMessage," ")}}function M(n,o){1&n&&(e.j41(0,"div",14),e.EFF(1,"Loading meters\u2026"),e.k0s())}function C(n,o){if(1&n&&(e.j41(0,"div",13),e.EFF(1),e.k0s()),2&n){const t=e.XpG(4);e.R7$(),e.JRh(t.errorMessage)}}function R(n,o){if(1&n&&(e.j41(0,"span",29),e.EFF(1),e.nI1(2,"lowercase"),e.k0s()),2&n){const t=e.XpG(3).$implicit;e.R7$(),e.SpI(" EAN code is required for ",e.bMT(2,1,t.label)," meters. ")}}function k(n,o){if(1&n&&(e.j41(0,"div",26)(1,"label"),e.EFF(2,"EAN Code "),e.j41(3,"span",27),e.EFF(4,"*"),e.k0s()(),e.nrm(5,"input",35),e.DNE(6,R,3,3,"span",36),e.k0s()),2&n){let t;const i=e.XpG(4);e.R7$(6),e.Y8G("ngIf",(null==(t=i.addForm.get("eanCode"))?null:t.touched)&&!(null!=(t=i.addForm.get("eanCode"))&&t.value))}}function S(n,o){1&n&&(e.j41(0,"span",29),e.EFF(1," Installation number is required for water meters. "),e.k0s())}function I(n,o){if(1&n&&(e.j41(0,"div",26)(1,"label"),e.EFF(2,"Installation Number "),e.j41(3,"span",27),e.EFF(4,"*"),e.k0s()(),e.nrm(5,"input",37),e.DNE(6,S,2,0,"span",36),e.k0s()),2&n){let t;const i=e.XpG(4);e.R7$(6),e.Y8G("ngIf",(null==(t=i.addForm.get("installationNumber"))?null:t.touched)&&!(null!=(t=i.addForm.get("installationNumber"))&&t.value))}}function y(n,o){1&n&&(e.j41(0,"span",29),e.EFF(1," Customer number is required for water meters on a building. "),e.k0s())}function $(n,o){if(1&n&&(e.j41(0,"div",26)(1,"label"),e.EFF(2,"Customer Number "),e.j41(3,"span",27),e.EFF(4,"*"),e.k0s()(),e.nrm(5,"input",38),e.DNE(6,y,2,0,"span",36),e.k0s()),2&n){let t;const i=e.XpG(4);e.R7$(6),e.Y8G("ngIf",(null==(t=i.addForm.get("customerNumber"))?null:t.touched)&&!(null!=(t=i.addForm.get("customerNumber"))&&t.value))}}function N(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",24)(1,"h4"),e.EFF(2),e.k0s(),e.DNE(3,C,2,1,"div",7),e.j41(4,"form",25),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG(3);return e.Njj(r.submitAdd())}),e.j41(5,"div",26)(6,"label"),e.EFF(7,"Meter Number "),e.j41(8,"span",27),e.EFF(9,"*"),e.k0s()(),e.nrm(10,"input",28),e.j41(11,"span",29),e.EFF(12),e.k0s()(),e.DNE(13,k,7,1,"div",30)(14,I,7,1,"div",30)(15,$,7,1,"div",30),e.j41(16,"div",26)(17,"label"),e.EFF(18,"Start Date "),e.j41(19,"span",27),e.EFF(20,"*"),e.k0s()(),e.nrm(21,"input",31),e.j41(22,"span",29),e.EFF(23),e.k0s()(),e.j41(24,"div",32)(25,"button",33),e.EFF(26,"Save"),e.k0s(),e.j41(27,"button",34),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.cancelPanel(r.type))}),e.EFF(28,"Cancel"),e.k0s()()()()}if(2&n){const t=e.XpG().$implicit,i=e.XpG(2);e.R7$(2),e.SpI("Add ",t.label," Meter"),e.R7$(),e.Y8G("ngIf",i.errorMessage),e.R7$(),e.Y8G("formGroup",i.addForm),e.R7$(8),e.JRh(i.fieldError(i.addForm,"meterNumber")),e.R7$(),e.Y8G("ngIf",i.needsEan(t.type)),e.R7$(),e.Y8G("ngIf",i.needsInstallation(t.type)),e.R7$(),e.Y8G("ngIf",i.needsCustomerNumber(t.type)),e.R7$(6),e.Y8G("max",i.today()),e.R7$(2),e.JRh(i.fieldError(i.addForm,"startDate"))}}function T(n,o){if(1&n&&(e.j41(0,"p",42),e.EFF(1),e.nI1(2,"lowercase"),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" No ",e.bMT(2,1,t.label)," meter assigned ")}}function O(n,o){if(1&n&&(e.j41(0,"div",13),e.EFF(1),e.k0s()),2&n){const t=e.XpG(6);e.R7$(),e.JRh(t.errorMessage)}}function x(n,o){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" \xb7 EAN ",t.eanCode,"")}}function G(n,o){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" \xb7 ",t.installationNumber,"")}}function j(n,o){1&n&&(e.j41(0,"div",26)(1,"label"),e.EFF(2,"New EAN Code "),e.j41(3,"span",27),e.EFF(4,"*"),e.k0s()(),e.nrm(5,"input",53),e.k0s())}function P(n,o){1&n&&(e.j41(0,"div",26)(1,"label"),e.EFF(2,"New Installation Number "),e.j41(3,"span",27),e.EFF(4,"*"),e.k0s()(),e.nrm(5,"input",54),e.k0s())}function w(n,o){1&n&&(e.j41(0,"div",26)(1,"label"),e.EFF(2,"New Customer Number "),e.j41(3,"span",27),e.EFF(4,"*"),e.k0s()(),e.nrm(5,"input",55),e.k0s())}function A(n,o){if(1&n&&(e.j41(0,"option",56),e.EFF(1),e.k0s()),2&n){const t=o.$implicit,i=e.XpG(6);e.Y8G("value",t),e.R7$(),e.SpI(" ",i.REPLACEMENT_REASON_LABELS[t]," ")}}function D(n,o){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"div",45)(2,"h4"),e.EFF(3),e.k0s(),e.DNE(4,O,2,1,"div",7),e.j41(5,"div",46)(6,"strong"),e.EFF(7,"Current:"),e.k0s(),e.EFF(8),e.DNE(9,x,2,1,"span",47)(10,G,2,1,"span",47),e.EFF(11),e.k0s(),e.j41(12,"form",25),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG(5);return e.Njj(r.submitReplace())}),e.j41(13,"div",26)(14,"label"),e.EFF(15,"New Meter Number "),e.j41(16,"span",27),e.EFF(17,"*"),e.k0s()(),e.nrm(18,"input",48),e.j41(19,"span",29),e.EFF(20),e.k0s()(),e.DNE(21,j,6,0,"div",30)(22,P,6,0,"div",30)(23,w,6,0,"div",30),e.j41(24,"div",26)(25,"label"),e.EFF(26,"New Start Date "),e.j41(27,"span",27),e.EFF(28,"*"),e.k0s()(),e.nrm(29,"input",49),e.j41(30,"span",29),e.EFF(31),e.k0s()(),e.j41(32,"div",26)(33,"label"),e.EFF(34,"Reason (optional)"),e.k0s(),e.j41(35,"select",50)(36,"option",51),e.EFF(37,"\u2014 Select reason \u2014"),e.k0s(),e.DNE(38,A,2,2,"option",52),e.k0s()(),e.j41(39,"div",32)(40,"button",33),e.EFF(41,"Save"),e.k0s(),e.j41(42,"button",34),e.bIt("click",function(){e.eBV(t);const r=e.XpG(3).$implicit,s=e.XpG(2);return e.Njj(s.cancelPanel(r.type))}),e.EFF(43,"Cancel"),e.k0s()()()(),e.bVm()}if(2&n){const t=e.XpG().$implicit,i=e.XpG(2).$implicit,r=e.XpG(2);e.R7$(3),e.SpI("Replace ",i.label," Meter"),e.R7$(),e.Y8G("ngIf",r.errorMessage),e.R7$(4),e.SpI(" ",t.meterNumber," "),e.R7$(),e.Y8G("ngIf",t.eanCode),e.R7$(),e.Y8G("ngIf",t.installationNumber),e.R7$(),e.SpI(" \xb7 since ",t.startDate," "),e.R7$(),e.Y8G("formGroup",r.replaceForm),e.R7$(8),e.JRh(r.fieldError(r.replaceForm,"newMeterNumber")),e.R7$(),e.Y8G("ngIf",r.needsEan(i.type)),e.R7$(),e.Y8G("ngIf",r.needsInstallation(i.type)),e.R7$(),e.Y8G("ngIf",r.needsCustomerNumber(i.type)),e.R7$(6),e.Y8G("max",r.today())("min",t.startDate),e.R7$(2),e.JRh(r.fieldError(r.replaceForm,"newStartDate")),e.R7$(5),e.Y8G("ngValue",null),e.R7$(2),e.Y8G("ngForOf",r.ALL_REPLACEMENT_REASONS)}}function Y(n,o){if(1&n&&(e.j41(0,"div",13),e.EFF(1),e.k0s()),2&n){const t=e.XpG(7);e.R7$(),e.JRh(t.errorMessage)}}function L(n,o){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"div",57)(2,"h4"),e.EFF(3),e.k0s(),e.DNE(4,Y,2,1,"div",7),e.j41(5,"p",58),e.EFF(6," \u26a0\ufe0f This meter will be deactivated. No replacement will be created. "),e.k0s(),e.j41(7,"p")(8,"strong"),e.EFF(9),e.k0s()(),e.j41(10,"form",25),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG(6);return e.Njj(r.submitRemove())}),e.j41(11,"div",26)(12,"label"),e.EFF(13,"End Date "),e.j41(14,"span",27),e.EFF(15,"*"),e.k0s()(),e.nrm(16,"input",59),e.j41(17,"span",29),e.EFF(18),e.k0s()(),e.j41(19,"div",32)(20,"button",60),e.EFF(21,"Confirm Remove"),e.k0s(),e.j41(22,"button",34),e.bIt("click",function(){e.eBV(t);const r=e.XpG(4).$implicit,s=e.XpG(2);return e.Njj(s.cancelPanel(r.type))}),e.EFF(23,"Cancel"),e.k0s()()()(),e.bVm()}if(2&n){const t=e.XpG(2).$implicit,i=e.XpG(2).$implicit,r=e.XpG(2);e.R7$(3),e.SpI("Remove ",i.label," Meter"),e.R7$(),e.Y8G("ngIf",r.errorMessage),e.R7$(5),e.JRh(t.meterNumber),e.R7$(),e.Y8G("formGroup",r.removeForm),e.R7$(6),e.Y8G("max",r.today())("min",t.startDate),e.R7$(2),e.JRh(r.fieldError(r.removeForm,"endDate"))}}function X(n,o){if(1&n&&(e.j41(0,"span",65),e.EFF(1),e.k0s()),2&n){const t=e.XpG(3).$implicit;e.R7$(),e.SpI("EAN: ",t.eanCode,"")}}function B(n,o){if(1&n&&(e.j41(0,"span",65),e.EFF(1),e.k0s()),2&n){const t=e.XpG(3).$implicit;e.R7$(),e.SpI(" Install #: ",t.installationNumber," ")}}function U(n,o){if(1&n&&(e.j41(0,"span",65),e.EFF(1),e.k0s()),2&n){const t=e.XpG(3).$implicit;e.R7$(),e.SpI(" Customer #: ",t.customerNumber," ")}}function H(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",61)(1,"div",62)(2,"span",63),e.EFF(3),e.k0s(),e.DNE(4,X,2,1,"span",64)(5,B,2,1,"span",64)(6,U,2,1,"span",64),e.j41(7,"span",65),e.EFF(8),e.k0s(),e.j41(9,"span",66),e.EFF(10),e.k0s()(),e.j41(11,"div",67)(12,"button",21),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2).$implicit,s=e.XpG(4);return e.Njj(s.openReplaceForm(r))}),e.EFF(13,"Replace"),e.k0s(),e.j41(14,"button",68),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2).$implicit,s=e.XpG(4);return e.Njj(s.openRemoveDialog(r))}),e.EFF(15,"Remove"),e.k0s()()()}if(2&n){const t=e.XpG(2).$implicit,i=e.XpG(4);e.R7$(3),e.JRh(t.meterNumber),e.R7$(),e.Y8G("ngIf",t.eanCode),e.R7$(),e.Y8G("ngIf",t.installationNumber),e.R7$(),e.Y8G("ngIf",t.customerNumber),e.R7$(2),e.SpI("Since ",t.startDate,""),e.R7$(2),e.SpI(" ",i.meterDurationMonths(t)," month(s) ")}}function V(n,o){if(1&n&&e.DNE(0,L,24,7,"ng-container",44)(1,H,16,6,"ng-template",null,1,e.C5r),2&n){const t=e.sdS(2),i=e.XpG().$implicit,r=e.XpG(2).$implicit,s=e.XpG(2);e.Y8G("ngIf",s.isRemoveOpen(r.type)&&(null==s.activeMeter?null:s.activeMeter.id)===i.id)("ngIfElse",t)}}function J(n,o){if(1&n&&(e.j41(0,"div",43),e.DNE(1,D,44,16,"ng-container",44)(2,V,3,2,"ng-template",null,0,e.C5r),e.k0s()),2&n){const t=o.$implicit,i=e.sdS(3),r=e.XpG(2).$implicit,s=e.XpG(2);e.R7$(),e.Y8G("ngIf",s.isReplaceOpen(r.type)&&(null==s.activeMeter?null:s.activeMeter.id)===t.id)("ngIfElse",i)}}function z(n,o){if(1&n&&(e.j41(0,"div",39),e.DNE(1,T,3,3,"p",40)(2,J,4,2,"div",41),e.k0s()),2&n){const t=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",0===t.meters.length),e.R7$(),e.Y8G("ngForOf",t.meters)}}function q(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",17)(1,"div",18)(2,"div",19)(3,"span",20),e.EFF(4),e.k0s(),e.j41(5,"span"),e.EFF(6),e.k0s()(),e.j41(7,"button",21),e.bIt("click",function(){const r=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.openAddForm(r.type))}),e.EFF(8," + Add Meter "),e.k0s()(),e.DNE(9,N,29,9,"div",22)(10,z,3,2,"div",23),e.k0s()}if(2&n){const t=o.$implicit,i=e.XpG(2);e.R7$(4),e.JRh(t.icon),e.R7$(2),e.JRh(t.label),e.R7$(3),e.Y8G("ngIf",i.isAddOpen(t.type)),e.R7$(),e.Y8G("ngIf",!i.isAddOpen(t.type))}}function W(n,o){if(1&n&&(e.j41(0,"div",15),e.DNE(1,q,11,4,"div",16),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.blocks)}}function K(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",69)(1,"button",70),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.toggleHistory())}),e.EFF(2),e.k0s()()}if(2&n){const t=e.XpG();e.R7$(2),e.SpI(" ",t.showHistory?"\u25b2 Hide History":"\u25bc View History"," ")}}function Q(n,o){1&n&&(e.j41(0,"th"),e.EFF(1,"Customer #"),e.k0s())}function Z(n,o){if(1&n&&(e.j41(0,"td"),e.EFF(1),e.k0s()),2&n){let t;const i=e.XpG().$implicit;e.R7$(),e.JRh(null!==(t=i.customerNumber)&&void 0!==t?t:"\u2014")}}function ee(n,o){if(1&n&&(e.j41(0,"tr")(1,"td")(2,"span",74),e.EFF(3),e.k0s(),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.DNE(9,Z,2,1,"td",47),e.j41(10,"td"),e.EFF(11),e.k0s(),e.j41(12,"td"),e.EFF(13),e.k0s(),e.j41(14,"td"),e.EFF(15),e.k0s(),e.j41(16,"td")(17,"span"),e.EFF(18),e.k0s()()()),2&n){let t,i;const r=o.$implicit,s=e.XpG(2);e.R7$(3),e.JRh(s.METER_TYPE_ICONS[r.type]),e.R7$(),e.SpI(" ",s.METER_TYPE_LABELS[r.type]," "),e.R7$(2),e.JRh(r.meterNumber),e.R7$(2),e.JRh(null!==(t=null!==(t=r.eanCode)&&void 0!==t?t:r.installationNumber)&&void 0!==t?t:"\u2014"),e.R7$(),e.Y8G("ngIf","BUILDING"===s.ownerType),e.R7$(2),e.JRh(r.startDate),e.R7$(2),e.JRh(null!==(i=r.endDate)&&void 0!==i?i:"\u2014"),e.R7$(2),e.SpI("",s.meterDurationMonths(r)," mo."),e.R7$(2),e.HbH("ACTIVE"===r.status?"badge badge-green":"badge badge-gray"),e.R7$(),e.SpI(" ",r.status," ")}}function te(n,o){if(1&n&&(e.j41(0,"tr")(1,"td",75),e.EFF(2," No meter history yet. "),e.k0s()()),2&n){const t=e.XpG(2);e.R7$(),e.BMQ("colspan","BUILDING"===t.ownerType?8:7)}}function ne(n,o){if(1&n&&(e.j41(0,"div",71)(1,"table",72)(2,"thead")(3,"tr")(4,"th"),e.EFF(5,"Type"),e.k0s(),e.j41(6,"th"),e.EFF(7,"Meter Number"),e.k0s(),e.j41(8,"th"),e.EFF(9,"EAN / Install #"),e.k0s(),e.DNE(10,Q,2,0,"th",47),e.j41(11,"th"),e.EFF(12,"Start Date"),e.k0s(),e.j41(13,"th"),e.EFF(14,"End Date"),e.k0s(),e.j41(15,"th"),e.EFF(16,"Duration"),e.k0s(),e.j41(17,"th"),e.EFF(18,"Status"),e.k0s()()(),e.j41(19,"tbody"),e.DNE(20,ee,19,11,"tr",73)(21,te,3,1,"tr",47),e.k0s()()()),2&n){const t=e.XpG();e.R7$(10),e.Y8G("ngIf","BUILDING"===t.ownerType),e.R7$(10),e.Y8G("ngForOf",t.history),e.R7$(),e.Y8G("ngIf",0===t.history.length)}}let ie=(()=>{class n{constructor(t,i,r){this.meterService=t,this.fb=i,this.cdr=r,this.blocks=[],this.history=[],this.showHistory=!1,this.loading=!1,this.errorMessage=null,this.successMessage=null,this.panelState={WATER:"idle",GAS:"idle",ELECTRICITY:"idle"},this.activeMeter=null,this.activeMeterType=null,this.ALL_METER_TYPES=f,this.ALL_REPLACEMENT_REASONS=l,this.METER_TYPE_LABELS=u,this.METER_TYPE_ICONS=g,this.REPLACEMENT_REASON_LABELS=d,this.meterDurationMonths=p}ngOnInit(){this.initForms(),this.loadActiveMeters()}initForms(){this.addForm=this.fb.group({type:["",a.k0.required],meterNumber:["",[a.k0.required,a.k0.maxLength(50)]],eanCode:[""],installationNumber:[""],customerNumber:[""],startDate:[this.today(),a.k0.required]}),this.replaceForm=this.fb.group({newMeterNumber:["",[a.k0.required,a.k0.maxLength(50)]],newEanCode:[""],newInstallationNumber:[""],newCustomerNumber:[""],newStartDate:[this.today(),a.k0.required],reason:[null]}),this.removeForm=this.fb.group({endDate:[this.today(),a.k0.required]})}loadActiveMeters(){this.loading=!0,("HOUSING_UNIT"===this.ownerType?this.meterService.getUnitActiveMeters(this.ownerId):this.meterService.getBuildingActiveMeters(this.ownerId)).subscribe({next:i=>{this.buildBlocks(i),this.loading=!1,this.cdr.markForCheck()},error:()=>{this.errorMessage="Failed to load meters.",this.loading=!1,this.cdr.markForCheck()}})}buildBlocks(t){this.blocks=f.map(i=>({type:i,label:u[i],icon:g[i],meters:t.filter(r=>r.type===i)}))}loadHistory(){("HOUSING_UNIT"===this.ownerType?this.meterService.getUnitMeterHistory(this.ownerId):this.meterService.getBuildingMeterHistory(this.ownerId)).subscribe({next:i=>{this.history=i,this.showHistory=!0,this.cdr.markForCheck()}})}toggleHistory(){this.showHistory?this.showHistory=!1:this.loadHistory()}get hasAnyMeter(){return this.blocks.some(t=>t.meters.length>0)}openAddForm(t){this.closeAllPanels(),this.panelState[t]="add",this.activeMeterType=t,this.addForm.reset({type:t,startDate:this.today()}),this.addForm.patchValue({type:t})}isAddOpen(t){return"add"===this.panelState[t]}get addType(){return this.addForm.value.type??null}needsEan(t){return"GAS"===t||"ELECTRICITY"===t}needsInstallation(t){return"WATER"===t}needsCustomerNumber(t){return"WATER"===t&&"BUILDING"===this.ownerType}submitAdd(){if(this.addForm.invalid)return void this.addForm.markAllAsTouched();const t=this.addForm.value,i={type:t.type,meterNumber:t.meterNumber,eanCode:t.eanCode||null,installationNumber:t.installationNumber||null,customerNumber:t.customerNumber||null,startDate:t.startDate};("HOUSING_UNIT"===this.ownerType?this.meterService.addUnitMeter(this.ownerId,i):this.meterService.addBuildingMeter(this.ownerId,i)).subscribe({next:()=>{this.showSuccess("Meter added successfully."),this.closeAllPanels(),this.loadActiveMeters(),this.showHistory&&this.loadHistory()},error:s=>this.showError(s)})}openReplaceForm(t){this.closeAllPanels(),this.activeMeter=t,this.panelState[t.type]="replace",this.replaceForm.reset({newStartDate:this.today()})}isReplaceOpen(t){return"replace"===this.panelState[t]}get replaceType(){return this.activeMeter?.type??null}submitReplace(){if(!this.activeMeter||this.replaceForm.invalid)return void this.replaceForm.markAllAsTouched();const t=this.replaceForm.value,i={newMeterNumber:t.newMeterNumber,newEanCode:t.newEanCode||null,newInstallationNumber:t.newInstallationNumber||null,newCustomerNumber:t.newCustomerNumber||null,newStartDate:t.newStartDate,reason:t.reason||null};("HOUSING_UNIT"===this.ownerType?this.meterService.replaceUnitMeter(this.ownerId,this.activeMeter.id,i):this.meterService.replaceBuildingMeter(this.ownerId,this.activeMeter.id,i)).subscribe({next:()=>{this.showSuccess("Meter replaced successfully."),this.closeAllPanels(),this.loadActiveMeters(),this.showHistory&&this.loadHistory()},error:s=>this.showError(s)})}openRemoveDialog(t){this.closeAllPanels(),this.activeMeter=t,this.panelState[t.type]="remove",this.removeForm.reset({endDate:this.today()})}isRemoveOpen(t){return"remove"===this.panelState[t]}submitRemove(){if(!this.activeMeter||this.removeForm.invalid)return void this.removeForm.markAllAsTouched();const t={endDate:this.removeForm.value.endDate};("HOUSING_UNIT"===this.ownerType?this.meterService.removeUnitMeter(this.ownerId,this.activeMeter.id,t):this.meterService.removeBuildingMeter(this.ownerId,this.activeMeter.id,t)).subscribe({next:()=>{this.showSuccess("Meter removed successfully."),this.closeAllPanels(),this.loadActiveMeters(),this.showHistory&&this.loadHistory()},error:r=>this.showError(r)})}cancelPanel(t){this.panelState[t]="idle",this.activeMeter=null,this.activeMeterType=null,this.errorMessage=null}closeAllPanels(){f.forEach(t=>this.panelState[t]="idle"),this.activeMeter=null,this.activeMeterType=null,this.errorMessage=null}showSuccess(t){this.successMessage=t,setTimeout(()=>{this.successMessage=null,this.cdr.markForCheck()},3500)}showError(t){this.errorMessage=t?.error?.message??"An error occurred.",this.cdr.markForCheck()}today(){return(new Date).toISOString().split("T")[0]}fieldError(t,i){const r=t.get(i);return r?.touched&&r.errors?r.errors.required?"This field is required.":r.errors.maxlength?`Max ${r.errors.maxlength.requiredLength} characters.`:"Invalid value.":null}static{this.\u0275fac=function(i){return new(i||n)(e.rXU(b),e.rXU(a.ok),e.rXU(e.gRc))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-meter-section"]],inputs:{ownerType:"ownerType",ownerId:"ownerId"},standalone:!0,features:[e.aNF],decls:12,vars:6,consts:[["meterView",""],["normalCard",""],[1,"meter-section"],[1,"section-header"],[1,"section-title"],[1,"material-icons","section-icon"],["class","alert alert-success",4,"ngIf"],["class","alert alert-error",4,"ngIf"],["class","loading-placeholder",4,"ngIf"],["class","type-blocks",4,"ngIf"],["class","history-toggle",4,"ngIf"],["class","history-panel",4,"ngIf"],[1,"alert","alert-success"],[1,"alert","alert-error"],[1,"loading-placeholder"],[1,"type-blocks"],["class","type-block",4,"ngFor","ngForOf"],[1,"type-block"],[1,"type-block-header"],[1,"type-label"],[1,"material-icons"],[1,"btn","btn-sm","btn-outline",3,"click"],["class","inline-form card",4,"ngIf"],["class","meter-list",4,"ngIf"],[1,"inline-form","card"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-group"],[1,"required"],["formControlName","meterNumber","type","text","placeholder","e.g. GAS-001"],[1,"field-error"],["class","form-group",4,"ngIf"],["formControlName","startDate","type","date",3,"max"],[1,"form-actions"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-ghost",3,"click"],["formControlName","eanCode","type","text","placeholder","18-digit EAN"],["class","field-error",4,"ngIf"],["formControlName","installationNumber","type","text","placeholder","e.g. IN-2024-001"],["formControlName","customerNumber","type","text","placeholder","e.g. CLI-00123"],[1,"meter-list"],["class","empty-state",4,"ngIf"],["class","meter-card",4,"ngFor","ngForOf"],[1,"empty-state"],[1,"meter-card"],[4,"ngIf","ngIfElse"],[1,"inline-form"],[1,"readonly-info"],[4,"ngIf"],["formControlName","newMeterNumber","type","text"],["formControlName","newStartDate","type","date",3,"max","min"],["formControlName","reason"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["formControlName","newEanCode","type","text"],["formControlName","newInstallationNumber","type","text"],["formControlName","newCustomerNumber","type","text"],[3,"value"],[1,"inline-form","remove-dialog"],[1,"warning-text"],["formControlName","endDate","type","date",3,"max","min"],["type","submit",1,"btn","btn-danger"],[1,"meter-card-content"],[1,"meter-info"],[1,"meter-number"],["class","meter-detail",4,"ngIf"],[1,"meter-detail"],[1,"meter-detail","muted"],[1,"meter-actions"],[1,"btn","btn-sm","btn-danger-outline",3,"click"],[1,"history-toggle"],[1,"btn","btn-link",3,"click"],[1,"history-panel"],[1,"data-table"],[4,"ngFor","ngForOf"],[1,"material-icons","icon-sm"],[1,"text-center","muted"]],template:function(i,r){1&i&&(e.j41(0,"section",2)(1,"div",3)(2,"h3",4)(3,"span",5),e.EFF(4,"electric_meter"),e.k0s(),e.EFF(5," Utility Meters "),e.k0s()(),e.DNE(6,E,2,1,"div",6)(7,F,2,1,"div",7)(8,M,2,0,"div",8)(9,W,2,1,"div",9)(10,K,3,1,"div",10)(11,ne,22,3,"div",11),e.k0s()),2&i&&(e.R7$(6),e.Y8G("ngIf",r.successMessage),e.R7$(),e.Y8G("ngIf",r.errorMessage&&!r.isAddOpen("WATER")&&!r.isAddOpen("GAS")&&!r.isAddOpen("ELECTRICITY")&&!r.isReplaceOpen("WATER")&&!r.isReplaceOpen("GAS")&&!r.isReplaceOpen("ELECTRICITY")&&!r.isRemoveOpen("WATER")&&!r.isRemoveOpen("GAS")&&!r.isRemoveOpen("ELECTRICITY")),e.R7$(),e.Y8G("ngIf",r.loading),e.R7$(),e.Y8G("ngIf",!r.loading),e.R7$(),e.Y8G("ngIf",r.hasAnyMeter||r.history.length>0),e.R7$(),e.Y8G("ngIf",r.showHistory))},dependencies:[_.MD,_.Sq,_.bT,_.GH,a.X1,a.qT,a.xH,a.y7,a.me,a.wz,a.BC,a.cb,a.j4,a.JD],styles:[".meter-section[_ngcontent-%COMP%]{margin-top:1.5rem}.section-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:1rem}.section-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:.4rem;margin:0}.section-title[_ngcontent-%COMP%]   .section-icon[_ngcontent-%COMP%]{font-size:1.2rem;color:var(--primary, #1976d2)}.type-blocks[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.type-block[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;overflow:hidden}.type-block-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.6rem 1rem;background-color:#f5f5f5;border-bottom:1px solid #e0e0e0}.type-block-header[_ngcontent-%COMP%]   .type-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;font-weight:600;font-size:.95rem}.type-block-header[_ngcontent-%COMP%]   .type-label[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:1.1rem;color:#555}.meter-list[_ngcontent-%COMP%]{padding:.75rem 1rem;display:flex;flex-direction:column;gap:.6rem}.empty-state[_ngcontent-%COMP%]{color:#888;font-style:italic;font-size:.9rem;margin:0}.meter-card[_ngcontent-%COMP%]{background:#fafafa;border:1px solid #e8e8e8;border-radius:6px;padding:.6rem .75rem}.meter-card-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.meter-info[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.4rem .75rem;align-items:center}.meter-number[_ngcontent-%COMP%]{font-weight:600}.meter-detail[_ngcontent-%COMP%]{font-size:.85rem;color:#555}.muted[_ngcontent-%COMP%]{color:#999}.meter-actions[_ngcontent-%COMP%]{display:flex;gap:.4rem}.inline-form[_ngcontent-%COMP%]{padding:1rem}.inline-form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:.95rem;font-weight:600}.readonly-info[_ngcontent-%COMP%]{background:#f0f0f0;border-radius:4px;padding:.5rem .75rem;font-size:.85rem;margin-bottom:.75rem}.form-group[_ngcontent-%COMP%]{margin-bottom:.75rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:.85rem;font-weight:500;margin-bottom:.25rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;max-width:360px;padding:.4rem .6rem;border:1px solid #ccc;border-radius:4px;font-size:.9rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:2px solid var(--primary, #1976d2);border-color:transparent}.required[_ngcontent-%COMP%]{color:#d32f2f;margin-left:2px}.field-error[_ngcontent-%COMP%]{display:block;color:#d32f2f;font-size:.8rem;margin-top:.2rem;min-height:1rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:.75rem}.remove-dialog[_ngcontent-%COMP%]   .warning-text[_ngcontent-%COMP%]{color:#e65100;font-size:.9rem;margin:.4rem 0}.history-toggle[_ngcontent-%COMP%]{margin-top:.75rem;text-align:right}.history-panel[_ngcontent-%COMP%]{margin-top:.5rem;overflow-x:auto}.data-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.data-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem .75rem;text-align:left;border-bottom:1px solid #e0e0e0}.data-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f5f5f5;font-weight:600}.data-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#fafafa}.icon-sm[_ngcontent-%COMP%]{font-size:1rem;vertical-align:middle;margin-right:2px}.badge[_ngcontent-%COMP%]{display:inline-block;padding:.2rem .5rem;border-radius:12px;font-size:.75rem;font-weight:600;text-transform:uppercase}.badge-green[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.badge-gray[_ngcontent-%COMP%]{background:#f5f5f5;color:#757575}.alert[_ngcontent-%COMP%]{padding:.6rem 1rem;border-radius:4px;margin-bottom:.75rem;font-size:.9rem}.alert-success[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32;border:1px solid #a5d6a7}.alert-error[_ngcontent-%COMP%]{background:#ffebee;color:#c62828;border:1px solid #ef9a9a}.btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.4rem .9rem;border-radius:4px;font-size:.875rem;cursor:pointer;border:1px solid transparent;font-weight:500;transition:opacity .15s}.btn[_ngcontent-%COMP%]:hover{opacity:.85}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .6rem;font-size:.8rem}.btn-primary[_ngcontent-%COMP%]{background:var(--primary, #1976d2);color:#fff}.btn-outline[_ngcontent-%COMP%]{background:transparent;border-color:#bbb;color:#333}.btn-ghost[_ngcontent-%COMP%]{background:transparent;color:#555}.btn-danger[_ngcontent-%COMP%]{background:#d32f2f;color:#fff}.btn-danger-outline[_ngcontent-%COMP%]{background:transparent;border-color:#d32f2f;color:#d32f2f}.btn-link[_ngcontent-%COMP%]{background:transparent;border:none;color:var(--primary, #1976d2);padding:.2rem .4rem}.loading-placeholder[_ngcontent-%COMP%]{color:#999;padding:1rem 0;font-style:italic}.text-center[_ngcontent-%COMP%]{text-align:center}"],changeDetection:0})}}return n})()}}]);