"use strict";(self.webpackChunkimmocare_frontend=self.webpackChunkimmocare_frontend||[]).push([[675],{4675:(R,l,a)=>{a.r(l),a.d(l,{UserDetailsComponent:()=>O});var d=a(177),i=a(4341),e=a(4438),m=a(3443),_=a(7282);const u=()=>({$implicit:!1});function p(n,o){1&n&&(e.j41(0,"div",5),e.EFF(1,"Loading\u2026"),e.k0s())}function g(n,o){if(1&n&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.JRh(t.errorMessage)}}function f(n,o){1&n&&e.eu8(0)}function h(n,o){1&n&&(e.j41(0,"div",19),e.EFF(1,"Password updated successfully."),e.k0s())}function b(n,o){if(1&n&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&n){const t=e.XpG(2);e.R7$(),e.JRh(t.deleteError)}}function w(n,o){if(1&n&&(e.j41(0,"div",6),e.EFF(1),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.JRh(t.pwError)}}function F(n,o){if(1&n&&(e.j41(0,"span",32),e.EFF(1),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.JRh(t.pwFieldError("newPassword"))}}function P(n,o){1&n&&(e.j41(0,"span",32),e.EFF(1,"Passwords do not match"),e.k0s())}function C(n,o){if(1&n&&(e.j41(0,"span",32),e.EFF(1),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.JRh(t.pwFieldError("confirmPassword"))}}function v(n,o){if(1&n){const t=e.RV6();e.j41(0,"div",20)(1,"h2"),e.EFF(2,"Change Password"),e.k0s(),e.DNE(3,w,2,1,"div",3),e.j41(4,"form",21),e.bIt("ngSubmit",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.submitPassword())}),e.j41(5,"div",22)(6,"label",23),e.EFF(7,"New Password "),e.j41(8,"span",24),e.EFF(9,"*"),e.k0s()(),e.nrm(10,"input",25),e.DNE(11,F,2,1,"span",26),e.k0s(),e.j41(12,"div",22)(13,"label",27),e.EFF(14,"Confirm Password "),e.j41(15,"span",24),e.EFF(16,"*"),e.k0s()(),e.nrm(17,"input",28),e.DNE(18,P,2,0,"span",26)(19,C,2,1,"span",26),e.k0s(),e.j41(20,"div",29)(21,"button",30),e.EFF(22),e.k0s(),e.j41(23,"button",31),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.togglePasswordForm())}),e.EFF(24,"Cancel"),e.k0s()()()()}if(2&n){let t,r;const s=e.XpG(2);e.R7$(3),e.Y8G("ngIf",s.pwError),e.R7$(),e.Y8G("formGroup",s.pwForm),e.R7$(6),e.AVh("invalid",(null==(t=s.pwForm.get("newPassword"))?null:t.invalid)&&(null==(t=s.pwForm.get("newPassword"))?null:t.touched)),e.R7$(),e.Y8G("ngIf",s.pwFieldError("newPassword")),e.R7$(6),e.AVh("invalid",(null==(r=s.pwForm.get("confirmPassword"))?null:r.invalid)&&(null==(r=s.pwForm.get("confirmPassword"))?null:r.touched)||s.pwMismatch),e.R7$(),e.Y8G("ngIf",s.pwMismatch),e.R7$(),e.Y8G("ngIf",!s.pwMismatch&&s.pwFieldError("confirmPassword")),e.R7$(2),e.Y8G("disabled",s.pwSubmitting),e.R7$(),e.SpI(" ",s.pwSubmitting?"Saving\u2026":"Save Password"," ")}}function E(n,o){if(1&n){const t=e.RV6();e.qex(0),e.j41(1,"div",7)(2,"div")(3,"button",8),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.back())}),e.EFF(4,"\u2190 Back"),e.k0s(),e.j41(5,"h1"),e.EFF(6),e.k0s()(),e.j41(7,"div",9)(8,"button",10),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.edit())}),e.EFF(9,"Edit"),e.k0s(),e.j41(10,"button",10),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.togglePasswordForm())}),e.EFF(11),e.k0s(),e.DNE(12,f,1,0,"ng-container",11),e.k0s()(),e.DNE(13,h,2,0,"div",12)(14,b,2,1,"div",3),e.j41(15,"div",13)(16,"div",14)(17,"span",15),e.EFF(18,"Username"),e.k0s(),e.j41(19,"span",16),e.EFF(20),e.k0s()(),e.j41(21,"div",14)(22,"span",15),e.EFF(23,"Email"),e.k0s(),e.j41(24,"span",16),e.EFF(25),e.k0s()(),e.j41(26,"div",14)(27,"span",15),e.EFF(28,"Role"),e.k0s(),e.j41(29,"span",16)(30,"span",17),e.EFF(31),e.k0s()()(),e.j41(32,"div",14)(33,"span",15),e.EFF(34,"Created At"),e.k0s(),e.j41(35,"span",16),e.EFF(36),e.nI1(37,"date"),e.k0s()(),e.j41(38,"div",14)(39,"span",15),e.EFF(40,"Updated At"),e.k0s(),e.j41(41,"span",16),e.EFF(42),e.nI1(43,"date"),e.k0s()()(),e.DNE(44,v,25,11,"div",18),e.bVm()}if(2&n){const t=e.XpG(),r=e.sdS(5);e.R7$(6),e.JRh(t.user.username),e.R7$(5),e.SpI(" ",t.showPasswordForm?"Cancel Password Change":"Change Password"," "),e.R7$(),e.Y8G("ngTemplateOutlet",r)("ngTemplateOutletContext",e.lJ4(18,u)),e.R7$(),e.Y8G("ngIf",t.pwSuccess),e.R7$(),e.Y8G("ngIf",t.deleteError),e.R7$(6),e.JRh(t.user.username),e.R7$(5),e.JRh(t.user.email),e.R7$(6),e.JRh(t.user.role),e.R7$(5),e.JRh(e.i5U(37,12,t.user.createdAt,"yyyy-MM-dd HH:mm")),e.R7$(6),e.JRh(e.i5U(43,15,t.user.updatedAt,"yyyy-MM-dd HH:mm")),e.R7$(2),e.Y8G("ngIf",t.showPasswordForm)}}function M(n,o){if(1&n){const t=e.RV6();e.j41(0,"span",33)(1,"button",34),e.bIt("click",function(){const s=e.eBV(t).$implicit,c=e.XpG();return e.Njj(c.confirmDelete(s))}),e.EFF(2),e.k0s()()}if(2&n){const t=o.$implicit,r=e.XpG();e.Y8G("title",r.isSelf?"You cannot delete your own account":t?"Cannot delete the last administrator account":""),e.R7$(),e.Y8G("disabled",r.isSelf||t||r.deleting),e.R7$(),e.SpI(" ",r.deleting?"Deleting\u2026":"Delete"," ")}}function k(n){const o=n.value;return o?/(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}/.test(o)?null:{complexity:"Must contain at least one uppercase letter, one lowercase letter, and one digit"}:null}function x(n){const o=n.get("newPassword")?.value,t=n.get("confirmPassword")?.value;return o&&t&&o!==t?{passwordsMismatch:!0}:null}let O=(()=>{class n{constructor(t,r,s,c){this.userService=t,this.route=r,this.router=s,this.fb=c,this.currentUsername="",this.loading=!1,this.errorMessage="",this.showPasswordForm=!1,this.pwSubmitting=!1,this.pwError="",this.pwSuccess=!1,this.deleting=!1,this.deleteError=""}ngOnInit(){const t=Number(this.route.snapshot.paramMap.get("id"));this.loading=!0,this.userService.getById(t).subscribe({next:r=>{this.user=r,this.loading=!1},error:()=>{this.errorMessage="User not found.",this.loading=!1}}),this.pwForm=this.fb.group({newPassword:["",[i.k0.required,i.k0.minLength(8),k]],confirmPassword:["",i.k0.required]},{validators:[x]})}get isSelf(){return this.user?.username===this.currentUsername}get pwMismatch(){return this.pwForm.hasError("passwordsMismatch")&&!!this.pwForm.get("confirmPassword")?.touched}edit(){this.user&&this.router.navigate(["/users",this.user.id,"edit"])}back(){this.router.navigate(["/users"])}togglePasswordForm(){this.showPasswordForm=!this.showPasswordForm,this.pwError="",this.pwSuccess=!1,this.pwForm.reset()}pwFieldError(t){const r=this.pwForm.get(t);return r&&r.invalid&&r.touched?r.errors?.required?"Required":r.errors?.minlength?"Too short":r.errors?.complexity?r.errors.complexity:"":""}submitPassword(){this.pwForm.markAllAsTouched(),!this.pwForm.invalid&&this.user&&(this.pwSubmitting=!0,this.userService.changePassword(this.user.id,{newPassword:this.pwForm.value.newPassword,confirmPassword:this.pwForm.value.confirmPassword}).subscribe({next:()=>{this.pwSubmitting=!1,this.pwSuccess=!0,this.showPasswordForm=!1,this.pwForm.reset()},error:t=>{this.pwSubmitting=!1,this.pwError=t.error?.message??"Failed to change password."}}))}confirmDelete(t){this.isSelf||t||confirm(`Delete user "${this.user?.username}"? This cannot be undone.`)&&(this.deleting=!0,this.userService.delete(this.user.id).subscribe({next:()=>{this.router.navigate(["/users"])},error:r=>{this.deleting=!1,this.deleteError=r.error?.message??"Failed to delete user."}}))}static{this.\u0275fac=function(r){return new(r||n)(e.rXU(m.D),e.rXU(_.nX),e.rXU(_.Ix),e.rXU(i.ok))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-user-details"]],standalone:!0,features:[e.aNF],decls:6,vars:3,consts:[["deleteBtn",""],[1,"user-details"],["class","loading",4,"ngIf"],["class","alert alert--error",4,"ngIf"],[4,"ngIf"],[1,"loading"],[1,"alert","alert--error"],[1,"user-details__header"],[1,"btn","btn--ghost",3,"click"],[1,"user-details__actions"],[1,"btn","btn--secondary",3,"click"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","alert alert--success",4,"ngIf"],[1,"card"],[1,"card__row"],[1,"card__label"],[1,"card__value"],[1,"badge","badge--role"],["class","password-form card",4,"ngIf"],[1,"alert","alert--success"],[1,"password-form","card"],["novalidate","",3,"ngSubmit","formGroup"],[1,"form-field"],["for","newPassword"],[1,"required"],["id","newPassword","type","password","formControlName","newPassword","placeholder","Min. 8 chars, 1 upper, 1 lower, 1 digit"],["class","field-error",4,"ngIf"],["for","confirmPassword"],["id","confirmPassword","type","password","formControlName","confirmPassword","placeholder","Repeat new password"],[1,"form-actions"],["type","submit",1,"btn","btn--primary",3,"disabled"],["type","button",1,"btn","btn--secondary",3,"click"],[1,"field-error"],[3,"title"],[1,"btn","btn--danger",3,"click","disabled"]],template:function(r,s){1&r&&(e.j41(0,"div",1),e.DNE(1,p,2,0,"div",2)(2,g,2,1,"div",3)(3,E,45,19,"ng-container",4)(4,M,3,3,"ng-template",null,0,e.C5r),e.k0s()),2&r&&(e.R7$(),e.Y8G("ngIf",s.loading),e.R7$(),e.Y8G("ngIf",s.errorMessage),e.R7$(),e.Y8G("ngIf",s.user&&!s.loading))},dependencies:[d.MD,d.bT,d.T3,d.vh,i.X1,i.qT,i.me,i.BC,i.cb,i.j4,i.JD],styles:[".user-details[_ngcontent-%COMP%]{padding:1.5rem;max-width:700px}.user-details__header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem}.user-details__header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:.25rem 0 0;font-size:1.5rem}.user-details__actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:1.25rem;margin-bottom:1.25rem}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.1rem}.card__row[_ngcontent-%COMP%]{display:flex;padding:.6rem 0;border-bottom:1px solid #f3f4f6}.card__row[_ngcontent-%COMP%]:last-child{border-bottom:none}.card__label[_ngcontent-%COMP%]{width:130px;flex-shrink:0;color:#6b7280;font-size:.875rem;font-weight:500}.card__value[_ngcontent-%COMP%]{font-size:.9rem;color:#111827}.badge--role[_ngcontent-%COMP%]{display:inline-block;padding:2px 8px;border-radius:9999px;background:#dbeafe;color:#1d4ed8;font-size:.75rem;font-weight:600}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-bottom:1rem}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.3rem;font-size:.9rem;color:#374151}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem .75rem;border:1px solid #d1d5db;border-radius:6px;font-size:.9rem;outline:none}.form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#2563eb;box-shadow:0 0 0 3px #2563eb26}.form-field[_ngcontent-%COMP%]   input.invalid[_ngcontent-%COMP%]{border-color:#dc2626}.required[_ngcontent-%COMP%]{color:#dc2626;margin-left:2px}.field-error[_ngcontent-%COMP%]{color:#dc2626;font-size:.8rem;margin-top:.25rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;margin-top:1rem}.btn[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:6px;border:1px solid transparent;cursor:pointer;font-size:.875rem;font-weight:500}.btn--primary[_ngcontent-%COMP%]{background:#2563eb;color:#fff;border-color:#2563eb}.btn--primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#1d4ed8}.btn--secondary[_ngcontent-%COMP%]{background:#fff;color:#374151;border-color:#d1d5db}.btn--secondary[_ngcontent-%COMP%]:hover{background:#f9fafb}.btn--ghost[_ngcontent-%COMP%]{background:none;border:none;color:#6b7280;padding:.3rem 0;cursor:pointer}.btn--ghost[_ngcontent-%COMP%]:hover{color:#111827}.btn--danger[_ngcontent-%COMP%]{background:#fff;color:#dc2626;border-color:#fca5a5}.btn--danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#fef2f2}.btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.alert[_ngcontent-%COMP%]{padding:.75rem 1rem;border-radius:6px;margin-bottom:1rem}.alert--error[_ngcontent-%COMP%]{background:#fef2f2;color:#dc2626;border:1px solid #fecaca}.alert--success[_ngcontent-%COMP%]{background:#f0fdf4;color:#16a34a;border:1px solid #bbf7d0}.loading[_ngcontent-%COMP%]{color:#6b7280;padding:2rem 0}"]})}}return n})()}}]);