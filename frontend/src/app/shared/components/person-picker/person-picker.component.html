<!-- shared/components/person-picker/person-picker.component.html -->
<div class="person-picker">
  <label class="picker-label">
    {{ label }}
    @if (required) {
      <span class="required">*</span>
    }
  </label>

  <!-- Selected person display -->
  @if (selectedPerson) {
    <div class="selected-person">
      <span class="selected-badge">
        {{ selectedPerson.lastName }} {{ selectedPerson.firstName }}
        @if (selectedPerson.city) {
          <span class="selected-city">— {{ selectedPerson.city }}</span>
        }
      </span>
      <button
        type="button"
        class="btn-clear"
        (click)="clearSelection()"
        title="Clear"
      >
        ✕
      </button>
    </div>
  } @else {
    <div class="picker-search-wrapper">
      <input
        type="text"
        class="picker-input"
        placeholder="Search by first or last name…"
        [formControl]="searchControl"
        (focus)="openPicker()"
        (blur)="closeDropdown()"
        autocomplete="off"
      />

      @if (isOpen) {
        <div class="picker-dropdown">
          @if (isLoading) {
            <div class="picker-item picker-hint">Searching…</div>
          }
          @if (showMinCharsHint && !isLoading) {
            <div class="picker-item picker-hint">
              Type at least 2 characters to search
            </div>
          }
          @if (!isLoading && !showMinCharsHint) {
            @for (person of results; track person.id) {
              <button
                type="button"
                class="picker-item picker-result"
                (mousedown)="selectPerson(person)"
              >
                <span class="result-name"
                  >{{ person.lastName }} {{ person.firstName }}</span
                >
                @if (person.city) {
                  <span class="result-meta"> — {{ person.city }}</span>
                }
                @if (person.nationalId) {
                  <span class="result-meta"> ({{ person.nationalId }})</span>
                }
                @if (person.isOwner) {
                  <span class="result-badge result-badge--owner">Owner</span>
                }
                @if (person.isTenant) {
                  <span class="result-badge result-badge--tenant">Tenant</span>
                }
              </button>
            }
            @if (noResults) {
              <div class="picker-item picker-hint">
                No person found.
                <a
                  routerLink="/persons/new"
                  target="_blank"
                  class="picker-create"
                  >+ Create new</a
                >
              </div>
            }
          }
        </div>
      }
    </div>
  }
</div>
