<div class="container py-4" style="max-width: 1100px;">

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary"></div>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="text-center py-5">
    <p class="text-danger">{{ error }}</p>
    <button class="btn btn-primary" (click)="goBack()">Back to Buildings</button>
  </div>

  <!-- Content -->
  <ng-container *ngIf="building && !loading">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/buildings">Buildings</a></li>
        <li class="breadcrumb-item active">{{ building.name }}</li>
      </ol>
    </nav>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="h3 mb-0 fw-bold">{{ building.name }}</h1>
      <div class="d-flex gap-2">
        <button class="btn btn-secondary btn-sm" (click)="goBack()">Back</button>
        <button class="btn btn-primary btn-sm" (click)="editBuilding()">Edit</button>
        <button class="btn btn-danger btn-sm" (click)="confirmDelete()">Delete</button>
      </div>
    </div>

    <!-- Delete error -->
    <div *ngIf="deleteError" class="alert alert-danger mb-3">{{ deleteError }}</div>

    <!-- Building Information -->
    <div class="card shadow-sm mb-3">
      <div class="card-header fw-semibold">Building Information</div>
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4 text-muted">Name</dt>
          <dd class="col-sm-8">{{ building.name }}</dd>

          <dt class="col-sm-4 text-muted">Street Address</dt>
          <dd class="col-sm-8">{{ building.streetAddress }}</dd>

          <dt class="col-sm-4 text-muted">Postal Code</dt>
          <dd class="col-sm-8">{{ building.postalCode }}</dd>

          <dt class="col-sm-4 text-muted">City</dt>
          <dd class="col-sm-8">{{ building.city }}</dd>

          <dt class="col-sm-4 text-muted">Country</dt>
          <dd class="col-sm-8">{{ building.country }}</dd>

          <dt class="col-sm-4 text-muted">Owner</dt>
          <dd class="col-sm-8">
            <a *ngIf="building.ownerId" [routerLink]="['/persons', building.ownerId]" class="text-decoration-none">
              {{ building.ownerName }}
            </a>
            <span *ngIf="!building.ownerId" class="text-muted fst-italic">Not specified</span>
          </dd>

          <dt class="col-sm-4 text-muted">Housing Units</dt>
          <dd class="col-sm-8">{{ building.unitCount }} unit(s)</dd>
        </dl>
      </div>
      <div class="card-footer text-muted small">
        Created by {{ building.createdByUsername || 'N/A' }}
        · {{ building.createdAt | date:'dd/MM/yyyy HH:mm' }}
        · Updated {{ building.updatedAt | date:'dd/MM/yyyy HH:mm' }}
      </div>
    </div>

    <!-- Meters section -->
    <div class="card shadow-sm mb-3">
      <app-meter-section [ownerType]="'BUILDING'" [ownerId]="building.id"></app-meter-section>
    </div>

    <!-- Housing Units section -->
    <div class="card shadow-sm mb-3">
      <app-housing-unit-list [buildingId]="building.id"></app-housing-unit-list>
    </div>

  </ng-container>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Building</h5>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete <strong>{{ building?.name }}</strong>?</p>
        <p class="text-danger small fw-semibold">This action cannot be undone.</p>
      </div>
      <div class="modal-footer gap-2">
        <button class="btn btn-secondary btn-sm" (click)="cancelDelete()">Cancel</button>
        <button class="btn btn-danger btn-sm" (click)="deleteBuilding()">Delete</button>
      </div>
    </div>
  </div>

</div>
