<div class="building-details-container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading">Loading...</div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="error-container">
    <p class="error">{{ error }}</p>
    <button class="btn btn-primary" (click)="goBack()">
      Back to Buildings
    </button>
  </div>

  <!-- Content -->
  <ng-container *ngIf="building && !loading">
    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="breadcrumb">
      <a routerLink="/buildings">Buildings</a>
      <span class="breadcrumb-separator">›</span>
      <span>{{ building.name }}</span>
    </nav>

    <!-- Header -->
    <div class="details-content">
      <div class="header">
        <h1>{{ building.name }}</h1>
        <div class="actions">
          <button class="btn btn-secondary" (click)="goBack()">Back</button>
          <button class="btn btn-primary" (click)="editBuilding()">Edit</button>
          <button class="btn btn-danger" (click)="confirmDelete()">
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Delete error -->
    <div *ngIf="deleteError" class="alert alert-error">{{ deleteError }}</div>

    <!-- Building Information -->
    <div class="info-card">
      <h2>Building Information</h2>
      <div class="info-grid">
        <div class="info-item">
          <label>Building Name</label>
          <p>{{ building.name }}</p>
        </div>
        <div class="info-item">
          <label>Street Address</label>
          <p>{{ building.streetAddress }}</p>
        </div>
        <div class="info-item">
          <label>Postal Code</label>
          <p>{{ building.postalCode }}</p>
        </div>
        <div class="info-item">
          <label>City</label>
          <p>{{ building.city }}</p>
        </div>
        <div class="info-item">
          <label>Country</label>
          <p>{{ building.country }}</p>
        </div>
        <div class="info-item">
          <label>Owner</label>
          <p>
            <a
              *ngIf="building.ownerId"
              [routerLink]="['/persons', building.ownerId]"
              >{{ building.ownerName }}</a
            >
            <span *ngIf="!building.ownerId" class="empty-message"
              >Not specified</span
            >
          </p>
        </div>
        <div class="info-item">
          <label>Housing Units</label>
          <p>{{ building.unitCount }} unit(s)</p>
        </div>
      </div>
      <div class="card-footer">
        Created by {{ building.createdByUsername || "N/A" }} ·
        {{ building.createdAt | date: "dd/MM/yyyy HH:mm" }} · Updated
        {{ building.updatedAt | date: "dd/MM/yyyy HH:mm" }}
      </div>
    </div>

    <!-- Meters section -->
    <div class="info-card">
      <app-meter-section
        [ownerType]="'BUILDING'"
        [ownerId]="building.id"
      ></app-meter-section>
    </div>

    <!-- Housing Units section -->
    <div class="info-card">
      <app-housing-unit-list [buildingId]="building.id"></app-housing-unit-list>
    </div>
  </ng-container>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Delete Building</h2>
      </div>
      <div class="modal-body">
        <p>
          Are you sure you want to delete <strong>{{ building?.name }}</strong
          >?
        </p>
        <p class="warning">This action cannot be undone.</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="cancelDelete()">
          Cancel
        </button>
        <button class="btn btn-danger" (click)="deleteBuilding()">
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
