<div class="person-form-container">
  <!-- Header -->
  <div class="details-content">
    <div class="header">
      <h1>{{ isEditMode ? "Edit Person" : "Add Person" }}</h1>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">Loading...</div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

  <div class="form-card" *ngIf="!isLoading">
    <form [formGroup]="form" (ngSubmit)="submit()">
      <!-- Identity -->
      <div class="form-section">
        <div class="form-section-title">Identity</div>
        <div class="form-row">
          <div class="form-group">
            <label>Last Name <span class="required">*</span></label>
            <input
              type="text"
              formControlName="lastName"
              [class.error]="isInvalid('lastName')"
            />
            <span class="error-message" *ngIf="isInvalid('lastName')"
              >Last name is required (max 100 chars).</span
            >
          </div>
          <div class="form-group">
            <label>First Name <span class="required">*</span></label>
            <input
              type="text"
              formControlName="firstName"
              [class.error]="isInvalid('firstName')"
            />
            <span class="error-message" *ngIf="isInvalid('firstName')"
              >First name is required (max 100 chars).</span
            >
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Date of Birth</label>
            <input type="date" formControlName="birthDate" />
          </div>
          <div class="form-group">
            <label>Place of Birth</label>
            <input type="text" formControlName="birthPlace" />
          </div>
        </div>
        <div class="form-group">
          <label>National ID</label>
          <input
            type="text"
            formControlName="nationalId"
            [class.error]="!!nationalIdConflictId"
          />
          <span class="error-message" *ngIf="nationalIdConflictId">
            This national ID already exists.
            <a [routerLink]="['/persons', nationalIdConflictId]" target="_blank"
              >View existing person</a
            >
          </span>
        </div>
      </div>

      <!-- Contact -->
      <div class="form-section">
        <div class="form-section-title">Contact</div>
        <div class="form-row">
          <div class="form-group">
            <label>GSM</label>
            <input
              type="text"
              formControlName="gsm"
              placeholder="+32 4xx xxx xxx"
            />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input
              type="email"
              formControlName="email"
              [class.error]="isInvalid('email')"
            />
            <span class="error-message" *ngIf="isInvalid('email')"
              >Please enter a valid email address.</span
            >
          </div>
        </div>
      </div>

      <!-- Address -->
      <div class="form-section">
        <div class="form-section-title">Address</div>
        <div class="form-group">
          <label>Street Address</label>
          <input type="text" formControlName="streetAddress" />
        </div>
        <div class="form-row form-row-3">
          <div class="form-group">
            <label>Postal Code</label>
            <input type="text" formControlName="postalCode" />
          </div>
          <div class="form-group">
            <label>City</label>
            <input type="text" formControlName="city" />
          </div>
          <div class="form-group">
            <label>Country</label>
            <input type="text" formControlName="country" />
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancel()">
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="isSaving || form.invalid || !!nationalIdConflictId"
        >
          {{
            isSaving
              ? "Saving..."
              : isEditMode
                ? "Save Changes"
                : "Create Person"
          }}
        </button>
      </div>
    </form>
  </div>
</div>
