<!-- features/lease/components/rent-adjustment-section/rent-adjustment-section.component.html -->
<div class="info-card">
  <div class="info-card-title">
    <h2>Rent History</h2>
    <button *ngIf="lease.status === 'ACTIVE' || lease.status === 'DRAFT'"
            class="btn btn-primary btn-sm"
            (click)="showForm ? showForm = false : openForm()">
      {{ showForm ? 'Cancel' : 'Adjust Rent' }}
    </button>
  </div>

  <!-- Current amounts summary -->
  <div class="rent-summary">
    <div class="rent-summary-item">
      <span class="rent-label">Rent</span>
      <span class="rent-value">{{ lease.monthlyRent | currency:'EUR':'symbol':'1.2-2' }}</span>
    </div>
    <div class="rent-summary-sep">+</div>
    <div class="rent-summary-item">
      <span class="rent-label">Charges <em>({{ lease.chargesType }})</em></span>
      <span class="rent-value">{{ lease.monthlyCharges | currency:'EUR':'symbol':'1.2-2' }}</span>
    </div>
    <div class="rent-summary-sep">=</div>
    <div class="rent-summary-item rent-summary-total">
      <span class="rent-label">Total</span>
      <span class="rent-value">{{ lease.totalRent | currency:'EUR':'symbol':'1.2-2' }}</span>
    </div>
  </div>

  <!-- Adjustment form -->
  <div *ngIf="showForm" class="picker-panel">
    <div *ngIf="formError" class="alert alert-error">{{ formError }}</div>

    <div class="form-row form-row-3">
      <div class="form-group">
        <label>Field <span class="required">*</span></label>
        <select [(ngModel)]="req.field" (ngModelChange)="onFieldChange()">
          <option value="RENT">Rent</option>
          <option value="CHARGES">Charges</option>
        </select>
      </div>
      <div class="form-group">
        <label>Current amount</label>
        <input type="number" [value]="currentValue" readonly />
      </div>
      <div class="form-group">
        <label>New amount (€) <span class="required">*</span></label>
        <input type="number" [(ngModel)]="req.newValue" step="0.01" min="0.01" />
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Effective date <span class="required">*</span></label>
        <input type="date" [(ngModel)]="req.effectiveDate" />
      </div>
      <div class="form-group">
        <label>Reason <span class="required">*</span></label>
        <input type="text" [(ngModel)]="req.reason"
               placeholder="e.g. Annual indexation, Market adjustment…" />
      </div>
    </div>
    <div class="form-actions">
      <button class="btn btn-secondary" (click)="showForm = false">Cancel</button>
      <button class="btn btn-primary" (click)="save()" [disabled]="isSaving">
        {{ isSaving ? 'Saving…' : 'Save adjustment' }}
      </button>
    </div>
  </div>

  <!-- History table -->
  <div *ngIf="lease.rentAdjustments && lease.rentAdjustments.length > 0" class="data-table">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Field</th>
          <th>Old</th>
          <th>New</th>
          <th>Δ</th>
          <th>Reason</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let adj of lease.rentAdjustments">
          <td>{{ adj.effectiveDate | date:'dd/MM/yyyy' }}</td>
          <td>
            <span class="field-badge" [class.field-rent]="adj.field === 'RENT'"
                  [class.field-charges]="adj.field === 'CHARGES'">
              {{ adj.field }}
            </span>
          </td>
          <td>{{ adj.oldValue | currency:'EUR':'symbol':'1.2-2' }}</td>
          <td><strong>{{ adj.newValue | currency:'EUR':'symbol':'1.2-2' }}</strong></td>
          <td [class.delta-up]="adj.newValue > adj.oldValue"
              [class.delta-down]="adj.newValue < adj.oldValue">
            {{ (adj.newValue > adj.oldValue ? '+' : '') }}{{ (adj.newValue - adj.oldValue) | currency:'EUR':'symbol':'1.2-2' }}
          </td>
          <td>{{ adj.reason }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <p *ngIf="!lease.rentAdjustments || lease.rentAdjustments.length === 0" class="empty-message">
    No adjustments recorded yet.
  </p>
</div>
