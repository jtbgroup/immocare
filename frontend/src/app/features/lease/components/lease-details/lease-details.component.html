<!-- features/lease/lease-details/lease-details.component.html -->
<div class="lease-details-container">

  <div *ngIf="isLoading" class="loading">Loadingâ€¦</div>
  <div *ngIf="errorMessage && !isLoading" class="error-container">
    <p class="error">{{ errorMessage }}</p>
  </div>

  <ng-container *ngIf="lease && !isLoading">

    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="breadcrumb">
      <a [routerLink]="['/buildings', lease.buildingId]">{{ lease.buildingName }}</a>
      <span class="breadcrumb-separator">â€º</span>
      <a [routerLink]="['/units', lease.housingUnitId]">Unit {{ lease.housingUnitNumber }}</a>
      <span class="breadcrumb-separator">â€º</span>
      <span>Lease #{{ lease.id }}</span>
    </nav>

    <!-- Header -->
    <div class="details-content">
      <div class="header">
        <div class="title-row">
          <h1>Lease #{{ lease.id }}</h1>
          <span class="badge" [ngClass]="statusClass">{{ lease.status }}</span>
          <span class="lease-type">{{ LEASE_TYPE_LABELS[lease.leaseType] }}</span>
        </div>
        <div class="actions">
          <a *ngIf="canEdit()" [routerLink]="['/leases', lease.id, 'edit']" class="btn btn-secondary">Edit</a>
        </div>
      </div>
    </div>

    <!-- Alert banners -->
    <div *ngIf="lease.indexationAlertActive" class="alert alert-warning">
      ðŸ”” Indexation due â€” anniversary {{ lease.indexationAlertDate | date:'dd/MM/yyyy' }}
    </div>
    <div *ngIf="lease.endNoticeAlertActive" class="alert alert-warning">
      âš  End notice deadline â€” {{ lease.endNoticeAlertDate | date:'dd/MM/yyyy' }}
    </div>

    <!-- Dates & Duration -->
    <div class="info-card">
      <h2>Dates &amp; Duration</h2>
      <div class="info-grid">
        <div class="info-item">
          <label>Signature</label>
          <p>{{ lease.signatureDate | date:'dd/MM/yyyy' }}</p>
        </div>
        <div class="info-item">
          <label>Start</label>
          <p>{{ lease.startDate | date:'dd/MM/yyyy' }}</p>
        </div>
        <div class="info-item">
          <label>End (planned)</label>
          <p>{{ lease.endDate | date:'dd/MM/yyyy' }}</p>
        </div>
        <div class="info-item">
          <label>Duration</label>
          <p>{{ lease.durationMonths }} months</p>
        </div>
        <div class="info-item">
          <label>Notice Period</label>
          <p>{{ lease.noticePeriodMonths }} months</p>
        </div>
      </div>
    </div>

    <!-- Rent (sub-component with history) -->
    <app-rent-adjustment-section
      [lease]="lease"
      (leaseUpdated)="loadLease(lease.id)">
    </app-rent-adjustment-section>

    <!-- Tenants (sub-component) -->
    <app-tenant-section
      [lease]="lease"
      (leaseUpdated)="loadLease(lease.id)">
    </app-tenant-section>

    <!-- Registration -->
    <div class="info-card"
         *ngIf="lease.registrationSpf || lease.registrationRegion">
      <h2>Registration</h2>
      <div class="info-grid">
        <div class="info-item" *ngIf="lease.registrationSpf">
          <label>SPF Finances</label>
          <p>{{ lease.registrationSpf }}</p>
        </div>
        <div class="info-item" *ngIf="lease.registrationRegion">
          <label>Region</label>
          <p>{{ lease.registrationRegion }}</p>
        </div>
      </div>
    </div>

    <!-- Deposit -->
    <div class="info-card" *ngIf="lease.depositAmount">
      <h2>Deposit</h2>
      <div class="info-grid">
        <div class="info-item">
          <label>Amount</label>
          <p>{{ lease.depositAmount | currency:'EUR':'symbol':'1.2-2' }}</p>
        </div>
        <div class="info-item">
          <label>Type</label>
          <p>{{ lease.depositType || 'â€”' }}</p>
        </div>
        <div class="info-item">
          <label>Reference</label>
          <p>{{ lease.depositReference || 'â€”' }}</p>
        </div>
      </div>
    </div>

    <!-- Tenant Insurance -->
    <div class="info-card" *ngIf="lease.tenantInsuranceConfirmed">
      <h2>Tenant Insurance</h2>
      <div class="info-grid">
        <div class="info-item">
          <label>Reference</label>
          <p>{{ lease.tenantInsuranceReference || 'â€”' }}</p>
        </div>
        <div class="info-item" *ngIf="lease.tenantInsuranceExpiry">
          <label>Expiry</label>
          <p>{{ lease.tenantInsuranceExpiry | date:'dd/MM/yyyy' }}</p>
        </div>
      </div>
    </div>

  </ng-container>
</div>
