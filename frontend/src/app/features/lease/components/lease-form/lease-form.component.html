<!-- features/lease/lease-form/lease-form.component.html -->
<div class="lease-form-container">
  <div class="details-content">
    <div class="header">
      <h1>{{ isEditMode ? "Edit Lease" : "Create Lease" }}</h1>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading">Loading…</div>
  <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

  <form *ngIf="!isLoading" [formGroup]="form">
    <!-- 1 — General -->
    <div class="form-card">
      <div class="form-section-title">1 — General</div>
      <div class="form-row form-row-3">
        <div class="form-group">
          <label>Signature Date <span class="required">*</span></label>
          <input
            type="date"
            formControlName="signatureDate"
            [class.error]="isInvalid('signatureDate')"
          />
        </div>
        <div class="form-group">
          <label>Start Date <span class="required">*</span></label>
          <input
            type="date"
            formControlName="startDate"
            [class.error]="isInvalid('startDate')"
          />
        </div>
        <div class="form-group">
          <label>End Date (computed)</label>
          <input type="date" [value]="computedEndDate" readonly />
        </div>
      </div>
      <div class="form-row form-row-3">
        <div class="form-group">
          <label>Lease Type <span class="required">*</span></label>
          <select formControlName="leaseType">
            <option *ngFor="let t of LEASE_TYPES" [value]="t">
              {{ LEASE_TYPE_LABELS[t] }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Duration (months) <span class="required">*</span></label>
          <input
            type="number"
            formControlName="durationMonths"
            min="1"
            [class.error]="isInvalid('durationMonths')"
          />
        </div>
        <div class="form-group">
          <label>Notice Period (months) <span class="required">*</span></label>
          <input type="number" formControlName="noticePeriodMonths" min="1" />
        </div>
      </div>
    </div>

    <!-- 2 — Financial -->
    <div class="form-card">
      <div class="form-section-title">2 — Financial</div>
      <div class="form-row form-row-3">
        <div class="form-group">
          <label>Monthly Rent (€) <span class="required">*</span></label>
          <input
            type="number"
            formControlName="monthlyRent"
            min="0.01"
            step="0.01"
            [class.error]="isInvalid('monthlyRent')"
          />
        </div>
        <div class="form-group">
          <label>Monthly Charges (€)</label>
          <input
            type="number"
            formControlName="monthlyCharges"
            min="0"
            step="0.01"
          />
        </div>
        <div class="form-group">
          <label>Charges Type</label>
          <select formControlName="chargesType">
            <option value="FORFAIT">Forfait</option>
            <option value="PROVISION">Provision</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Charges Description</label>
        <input type="text" formControlName="chargesDescription" />
      </div>
    </div>

    <!-- 3 — Registration -->
    <div class="form-card">
      <div class="form-section-title">3 — Registration</div>
      <div class="form-row">
        <div class="form-group">
          <label>SPF Finances Number</label>
          <input type="text" formControlName="registrationSpf" />
        </div>
        <div class="form-group">
          <label>Region Number</label>
          <input type="text" formControlName="registrationRegion" />
        </div>
      </div>
    </div>

    <!-- 4 — Deposit -->
    <div class="form-card">
      <div class="form-section-title">4 — Guarantee / Deposit</div>
      <div class="form-row form-row-3">
        <div class="form-group">
          <label>Amount (€)</label>
          <input
            type="number"
            formControlName="depositAmount"
            min="0"
            step="0.01"
          />
        </div>
        <div class="form-group">
          <label>Type</label>
          <select formControlName="depositType">
            <option [value]="null">—</option>
            <option value="BLOCKED_ACCOUNT">Blocked Account</option>
            <option value="BANK_GUARANTEE">Bank Guarantee</option>
            <option value="CPAS">CPAS</option>
            <option value="INSURANCE">Insurance</option>
          </select>
        </div>
        <div class="form-group">
          <label>Reference</label>
          <input type="text" formControlName="depositReference" />
        </div>
      </div>
    </div>

    <!-- 5 — Tenant Insurance -->
    <div class="form-card">
      <div class="form-section-title">5 — Tenant Insurance</div>
      <div class="form-check-group">
        <input
          type="checkbox"
          id="insuranceCheck"
          formControlName="tenantInsuranceConfirmed"
        />
        <label for="insuranceCheck">Insurance confirmed</label>
      </div>
      <div *ngIf="showInsuranceDetails" class="form-row">
        <div class="form-group">
          <label>Reference</label>
          <input type="text" formControlName="tenantInsuranceReference" />
        </div>
        <div class="form-group">
          <label>Expiry Date</label>
          <input type="date" formControlName="tenantInsuranceExpiry" />
        </div>
      </div>
    </div>

    <!-- 6 — Tenants (create only) -->
    <div class="form-card" *ngIf="!isEditMode">
      <div class="form-section-title">6 — Tenants</div>
      <ul *ngIf="pendingTenants.length" class="tenant-list">
        <li *ngFor="let t of pendingTenants">
          <span class="tenant-name"
            >{{ t.person.lastName }} {{ t.person.firstName }}</span
          >
          <select
            class="tenant-role-select"
            [(ngModel)]="t.role"
            [ngModelOptions]="{ standalone: true }"
          >
            <option value="PRIMARY">Primary</option>
            <option value="CO_TENANT">Co-tenant</option>
            <option value="GUARANTOR">Guarantor</option>
          </select>
          <button
            type="button"
            class="btn btn-sm btn-danger"
            (click)="removeTenant(t.person.id)"
          >
            ✕
          </button>
        </li>
      </ul>
      <app-person-picker
        (personSelected)="addTenant($event)"
      ></app-person-picker>
    </div>

    <div class="form-actions">
      <a
        [routerLink]="isEditMode ? ['/leases', leaseId] : ['/units', unitId]"
        class="btn btn-secondary"
        >Cancel</a
      >
      <button
        type="button"
        class="btn btn-primary"
        (click)="save()"
        [disabled]="isSaving"
      >
        {{ isSaving ? "Saving…" : isEditMode ? "Save" : "Create" }}
      </button>
    </div>
  </form>
</div>
