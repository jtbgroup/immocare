<!-- features/lease/lease-form/lease-form.component.html -->
<div class="lease-form-container">
  <!-- Header -->
  <div class="details-content">
    <div class="header">
      <h1>{{ isEditMode ? "Edit Lease" : "Create Lease" }}</h1>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">Loading…</div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

  <form *ngIf="!isLoading" [formGroup]="form">
    <!-- Section 1: General -->
    <div class="form-card">
      <div class="form-section-title">1 — General</div>
      <div class="form-row form-row-3">
        <div class="form-group">
          <label>Signature Date <span class="required">*</span></label>
          <input
            type="date"
            formControlName="signatureDate"
            [class.error]="isInvalid('signatureDate')"
          />
        </div>
        <div class="form-group">
          <label>Start Date <span class="required">*</span></label>
          <input
            type="date"
            formControlName="startDate"
            [class.error]="isInvalid('startDate')"
          />
        </div>
        <div class="form-group">
          <label>End Date (computed)</label>
          <input type="date" [value]="computedEndDate" readonly />
        </div>
      </div>
      <div class="form-row form-row-3">
        <div class="form-group">
          <label>Lease Type <span class="required">*</span></label>
          <select formControlName="leaseType">
            <option *ngFor="let t of LEASE_TYPES" [value]="t">
              {{ LEASE_TYPE_LABELS[t] }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Duration (months) <span class="required">*</span></label>
          <input
            type="number"
            formControlName="durationMonths"
            min="1"
            [class.error]="isInvalid('durationMonths')"
          />
        </div>
        <div class="form-group">
          <label>Notice Period (months) <span class="required">*</span></label>
          <input type="number" formControlName="noticePeriodMonths" min="1" />
        </div>
      </div>
    </div>

    <!-- Section 2: Financial -->
    <div class="form-card">
      <div class="form-section-title">2 — Financial</div>
      <div class="form-row form-row-3">
        <div class="form-group">
          <label>Monthly Rent (€) <span class="required">*</span></label>
          <input
            type="number"
            formControlName="monthlyRent"
            min="0.01"
            step="0.01"
            [class.error]="isInvalid('monthlyRent')"
          />
        </div>
        <div class="form-group">
          <label>Monthly Charges (€)</label>
          <input
            type="number"
            formControlName="monthlyCharges"
            min="0"
            step="0.01"
          />
        </div>
        <div class="form-group">
          <label>Charges Type</label>
          <select formControlName="chargesType">
            <option value="FORFAIT">Forfait</option>
            <option value="PROVISION">Provision</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Charges Description</label>
        <input type="text" formControlName="chargesDescription" />
      </div>
    </div>

    <!-- Section 3: Indexation -->
    <div class="form-card">
      <div class="form-section-title">3 — Indexation</div>
      <div class="form-row">
        <div class="form-group">
          <label>Base Index Value</label>
          <input type="number" formControlName="baseIndexValue" step="0.0001" />
        </div>
        <div class="form-group">
          <label>Base Index Month</label>
          <input type="month" formControlName="baseIndexMonth" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Anniversary Month</label>
          <select formControlName="indexationAnniversaryMonth">
            <option [value]="null">—</option>
            <option
              *ngFor="let m of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]"
              [value]="m"
            >
              {{ m }}
            </option>
          </select>
        </div>
        <div class="form-group">
          <label>Notice (days)</label>
          <input type="number" formControlName="indexationNoticeDays" min="0" />
        </div>
      </div>
    </div>

    <!-- Section 4: Registration -->
    <div class="form-card">
      <div class="form-section-title">4 — Registration</div>
      <div class="form-row">
        <div class="form-group">
          <label>SPF Finances Number</label>
          <input type="text" formControlName="registrationSpf" />
        </div>
        <div class="form-group">
          <label>Region Number</label>
          <input type="text" formControlName="registrationRegion" />
        </div>
      </div>
    </div>

    <!-- Section 5: Deposit -->
    <div class="form-card">
      <div class="form-section-title">5 — Guarantee / Deposit</div>
      <div class="form-row form-row-3">
        <div class="form-group">
          <label>Deposit Amount (€)</label>
          <input
            type="number"
            formControlName="depositAmount"
            min="0"
            step="0.01"
          />
        </div>
        <div class="form-group">
          <label>Deposit Type</label>
          <select formControlName="depositType">
            <option [value]="null">—</option>
            <option value="BLOCKED_ACCOUNT">Blocked Account</option>
            <option value="BANK_GUARANTEE">Bank Guarantee</option>
            <option value="CPAS">CPAS</option>
            <option value="INSURANCE">Insurance</option>
          </select>
        </div>
        <div class="form-group">
          <label>Deposit Reference</label>
          <input type="text" formControlName="depositReference" />
        </div>
      </div>
    </div>

    <!-- Section 6: Insurance -->
    <div class="form-card">
      <div class="form-section-title">6 — Tenant Insurance</div>
      <div class="form-check-group">
        <input
          type="checkbox"
          formControlName="tenantInsuranceConfirmed"
          id="insuranceCheck"
        />
        <label for="insuranceCheck">Insurance confirmed</label>
      </div>
      <div *ngIf="showInsuranceDetails" class="form-row">
        <div class="form-group">
          <label>Policy Reference</label>
          <input type="text" formControlName="tenantInsuranceReference" />
        </div>
        <div class="form-group">
          <label>Expiry Date</label>
          <input type="date" formControlName="tenantInsuranceExpiry" />
        </div>
      </div>
    </div>

    <!-- Section 7: Tenants -->
    <div class="form-card">
      <div class="form-section-title">7 — Tenants</div>

      <ul class="tenant-list">
        <li *ngFor="let t of pendingTenants; let i = index">
          <span class="tenant-name"
            >{{ t.person.lastName }} {{ t.person.firstName }}</span
          >
          <select
            class="tenant-role-select"
            [value]="t.role"
            (change)="updateTenantRole(i, $event)"
          >
            <option value="PRIMARY">Primary</option>
            <option value="CO_TENANT">Co-Tenant</option>
            <option value="GUARANTOR">Guarantor</option>
          </select>
          <button
            type="button"
            class="btn btn-danger btn-sm"
            (click)="removeTenantFromForm(i)"
          >
            ✕
          </button>
        </li>
      </ul>

      <p *ngIf="!hasPrimaryTenant()" class="error-message">
        At least one PRIMARY tenant is required.
      </p>

      <app-person-picker
        label="Add Tenant"
        [required]="false"
        (personSelected)="addTenantToForm($event)"
      >
      </app-person-picker>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="cancel()">
        Cancel
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        (click)="saveAsDraft()"
        [disabled]="isSaving"
      >
        {{ isSaving ? "Saving…" : "Save as Draft" }}
      </button>
      <button
        *ngIf="!isEditMode"
        type="button"
        class="btn btn-primary"
        (click)="saveAndActivate()"
        [disabled]="isSaving"
      >
        Save &amp; Activate
      </button>
      <button
        *ngIf="isEditMode"
        type="button"
        class="btn btn-primary"
        (click)="saveAsDraft()"
        [disabled]="isSaving"
      >
        Save Changes
      </button>
    </div>
  </form>
</div>
