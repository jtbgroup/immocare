<!-- lease-section.component.html â€” with inline history -->
<section class="lease-section">
  <!-- Header -->
  <div class="section-header">
    <h3>Lease</h3>
    <a
      *ngIf="canCreateLease && !isLoading"
      [routerLink]="['/housing-units', unitId, 'leases', 'new']"
      class="btn btn-sm btn-primary"
      >+ Create Lease</a
    >
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-placeholder">Loading leaseâ€¦</div>

  <!-- No active lease -->
  <div *ngIf="!isLoading && !activeLease" class="lease-card lease-card-empty">
    No active lease.
  </div>

  <!-- Active lease card -->
  <div *ngIf="!isLoading && activeLease" class="lease-card">
    <!-- Alert banners -->
    <div
      *ngIf="activeLease.indexationAlertActive"
      class="alert-banner alert-banner-warning"
    >
      ðŸ”” Indexation due â€” anniversary
      {{ activeLease.indexationAlertDate | date: "dd/MM/yyyy" }}
    </div>
    <div
      *ngIf="activeLease.endNoticeAlertActive"
      class="alert-banner alert-banner-orange"
    >
      âš  End notice deadline â€”
      {{ activeLease.endNoticeAlertDate | date: "dd/MM/yyyy" }}
    </div>

    <!-- Card body -->
    <div class="lease-card-body">
      <!-- Left: status badge + type -->
      <div class="lease-badge-col">
        <span class="lease-status-badge" [ngClass]="activeStatusClass">
          {{ activeLease.status }}
        </span>
        <span class="lease-type-label">
          {{ LEASE_TYPE_LABELS[activeLease.leaseType] }}
        </span>
      </div>

      <!-- Right: details -->
      <div class="lease-details">
        <div class="lease-detail-row">
          <span class="lease-detail-label">Tenants:</span>
          <span>{{ activeLease.tenantNames.join(", ") || "â€”" }}</span>
        </div>
        <div class="lease-detail-row">
          <span class="lease-detail-label">Rent:</span>
          <span>{{
            activeLease.monthlyRent | currency: "EUR" : "symbol" : "1.2-2"
          }}</span>
          <span *ngIf="activeLease.monthlyCharges > 0" class="muted">
            &nbsp;+
            {{
              activeLease.monthlyCharges | currency: "EUR" : "symbol" : "1.2-2"
            }}
            charges ({{ activeLease.chargesType }})
          </span>
        </div>
        <div class="lease-detail-row">
          <span class="lease-detail-label">Period:</span>
          <span>
            {{ activeLease.startDate | date: "dd/MM/yyyy" }} â†’
            {{ activeLease.endDate | date: "dd/MM/yyyy" }}
          </span>
        </div>
      </div>

      <!-- Actions -->
      <div class="lease-actions">
        <a
          [routerLink]="['/leases', activeLease.id]"
          class="btn btn-sm btn-secondary"
          >View</a
        >
        <a
          [routerLink]="['/leases', activeLease.id, 'edit']"
          class="btn btn-sm btn-ghost"
          >Edit</a
        >
      </div>
    </div>
  </div>

  <!-- View History toggle -->
  <div *ngIf="!isLoading && pastLeases.length > 0" class="lease-footer">
    <button class="btn-link" (click)="toggleHistory()">
      {{ showHistory ? "Hide History" : "View History" }}
    </button>
  </div>

  <!-- History panel -->
  <div *ngIf="showHistory" class="history-panel">
    <div class="history-header">
      <h4>Lease History</h4>
      <button class="btn-close" (click)="toggleHistory()">âœ•</button>
    </div>
    <table class="history-table">
      <thead>
        <tr>
          <th>Status</th>
          <th>Type</th>
          <th>Tenants</th>
          <th>Rent</th>
          <th>Period</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let lease of pastLeases">
          <td>
            <span class="lease-status-badge" [ngClass]="statusClass(lease)">
              {{ lease.status }}
            </span>
          </td>
          <td class="muted">{{ LEASE_TYPE_LABELS[lease.leaseType] }}</td>
          <td>{{ lease.tenantNames.join(", ") || "â€”" }}</td>
          <td>
            {{ lease.monthlyRent | currency: "EUR" : "symbol" : "1.0-0" }}
          </td>
          <td class="muted">
            {{ lease.startDate | date: "dd/MM/yyyy" }} â†’
            {{ lease.endDate | date: "dd/MM/yyyy" }}
          </td>
          <td>
            <a [routerLink]="['/leases', lease.id]" class="btn-link">View</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
