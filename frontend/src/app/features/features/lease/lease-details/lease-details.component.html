<!-- lease-details.component.html -->
<div class="container py-4" style="max-width:900px;" *ngIf="!isLoading">
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

  <ng-container *ngIf="lease">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb"><ol class="breadcrumb small">
      <li class="breadcrumb-item"><a [routerLink]="['/buildings', lease.buildingId]">{{ lease.buildingName }}</a></li>
      <li class="breadcrumb-item"><a [routerLink]="['/housing-units', lease.housingUnitId]">Unit {{ lease.housingUnitNumber }}</a></li>
      <li class="breadcrumb-item active">Lease #{{ lease.id }}</li>
    </ol></nav>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-start mb-4">
      <div>
        <h2 class="h3 mb-2">
          Lease #{{ lease.id }}
          <span class="badge ms-2" [ngClass]="statusClass">{{ lease.status }}</span>
        </h2>
        <span class="text-muted">{{ LEASE_TYPE_LABELS[lease.leaseType] }}</span>
      </div>
      <div class="d-flex gap-2 flex-wrap">
        <a *ngIf="canEdit()" [routerLink]="['/leases', lease.id, 'edit']" class="btn btn-outline-secondary btn-sm">Edit</a>
        <button *ngIf="canActivate()" class="btn btn-success btn-sm" (click)="doActivate()" [disabled]="isTransitioning">Activate</button>
        <button *ngIf="canFinish()" class="btn btn-info btn-sm text-white" (click)="doFinish()" [disabled]="isTransitioning">Finish</button>
        <button *ngIf="canCancel()" class="btn btn-danger btn-sm" (click)="doCancel()" [disabled]="isTransitioning">Cancel</button>
      </div>
    </div>

    <!-- Status error -->
    <div *ngIf="statusError" class="alert alert-danger">{{ statusError }}</div>

    <!-- Alert banners -->
    <div *ngIf="lease.indexationAlertActive" class="alert alert-warning py-2 mb-3">
      ðŸ”” Indexation due â€” anniversary {{ lease.indexationAlertDate | date:'dd/MM/yyyy' }}
    </div>
    <div *ngIf="lease.endNoticeAlertActive" class="alert alert-warning py-2 mb-3">
      âš  End notice deadline â€” {{ lease.endNoticeAlertDate | date:'dd/MM/yyyy' }}
    </div>

    <!-- Dates & Duration -->
    <div class="card shadow-sm mb-3">
      <div class="card-header fw-semibold">Dates & Duration</div>
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4 text-muted">Signature</dt><dd class="col-sm-8">{{ lease.signatureDate | date:'dd/MM/yyyy' }}</dd>
          <dt class="col-sm-4 text-muted">Start</dt><dd class="col-sm-8">{{ lease.startDate | date:'dd/MM/yyyy' }}</dd>
          <dt class="col-sm-4 text-muted">End (planned)</dt><dd class="col-sm-8">{{ lease.endDate | date:'dd/MM/yyyy' }}</dd>
          <dt class="col-sm-4 text-muted">Duration</dt><dd class="col-sm-8">{{ lease.durationMonths }} months</dd>
          <dt class="col-sm-4 text-muted">Notice Period</dt><dd class="col-sm-8">{{ lease.noticePeriodMonths }} months</dd>
        </dl>
      </div>
    </div>

    <!-- Financial -->
    <div class="card shadow-sm mb-3">
      <div class="card-header fw-semibold">Financial</div>
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4 text-muted">Monthly Rent</dt><dd class="col-sm-8">{{ lease.monthlyRent | currency:'EUR':'symbol':'1.2-2' }}</dd>
          <dt class="col-sm-4 text-muted">Monthly Charges</dt><dd class="col-sm-8">{{ lease.monthlyCharges | currency:'EUR':'symbol':'1.2-2' }} ({{ lease.chargesType }})</dd>
          <dt *ngIf="lease.chargesDescription" class="col-sm-4 text-muted">Charges Description</dt>
          <dd *ngIf="lease.chargesDescription" class="col-sm-8">{{ lease.chargesDescription }}</dd>
        </dl>
      </div>
    </div>

    <!-- Tenants section (sub-component) -->
    <app-tenant-section [lease]="lease" (leaseUpdated)="loadLease(lease.id)"></app-tenant-section>

    <!-- Indexation section (sub-component) -->
    <app-indexation-section [lease]="lease" (leaseUpdated)="loadLease(lease.id)"></app-indexation-section>

    <!-- Deposit -->
    <div class="card shadow-sm mb-3" *ngIf="lease.depositAmount">
      <div class="card-header fw-semibold">Deposit</div>
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4 text-muted">Amount</dt><dd class="col-sm-8">{{ lease.depositAmount | currency:'EUR':'symbol':'1.2-2' }}</dd>
          <dt class="col-sm-4 text-muted">Type</dt><dd class="col-sm-8">{{ lease.depositType || 'â€”' }}</dd>
          <dt class="col-sm-4 text-muted">Reference</dt><dd class="col-sm-8">{{ lease.depositReference || 'â€”' }}</dd>
        </dl>
      </div>
    </div>

  </ng-container>
</div>
<div *ngIf="isLoading" class="text-center py-5"><div class="spinner-border"></div></div>
