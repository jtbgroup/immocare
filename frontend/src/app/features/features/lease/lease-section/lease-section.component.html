<!-- lease-section.component.html -->
<div class="card shadow-sm mb-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span class="fw-semibold">Lease</span>
    <div class="d-flex gap-2">
      <a
        *ngIf="activeLease"
        [routerLink]="['/leases', activeLease.id]"
        class="btn btn-outline-primary btn-sm"
        >View</a
      >
      <a
        *ngIf="activeLease"
        [routerLink]="['/leases', activeLease.id, 'edit']"
        class="btn btn-outline-secondary btn-sm"
        >Edit</a
      >
      <a
        *ngIf="canCreateLease"
        [routerLink]="['/housing-units', unitId, 'leases', 'new']"
        class="btn btn-primary btn-sm"
        >+ Create Lease</a
      >
    </div>
  </div>

  <div *ngIf="isLoading" class="card-body text-center py-3">
    <div class="spinner-border spinner-border-sm"></div>
  </div>

  <div *ngIf="!isLoading && !activeLease" class="card-body text-muted small">
    No active lease.
  </div>

  <div *ngIf="!isLoading && activeLease" class="card-body">
    <!-- Alert banners -->
    <div
      *ngIf="activeLease.indexationAlertActive"
      class="alert alert-warning py-2 mb-2 d-flex align-items-center gap-2"
    >
      <span>ðŸ””</span>
      <span
        >Indexation due â€” anniversary
        {{ activeLease.indexationAlertDate | date: "dd/MM/yyyy" }}</span
      >
    </div>
    <div
      *ngIf="activeLease.endNoticeAlertActive"
      class="alert alert-orange py-2 mb-2 d-flex align-items-center gap-2"
      style="background: #fff3cd; border-color: #ffc107"
    >
      <span>âš </span>
      <span
        >End notice deadline â€”
        {{ activeLease.endNoticeAlertDate | date: "dd/MM/yyyy" }}</span
      >
    </div>

    <!-- Lease info -->
    <div class="d-flex align-items-center gap-2 mb-2">
      <span class="badge" [ngClass]="statusClass">{{
        activeLease.status
      }}</span>
      <span class="text-muted small">{{
        LEASE_TYPE_LABELS[activeLease.leaseType]
      }}</span>
    </div>
    <div class="mb-1">
      <strong>Tenants:</strong>
      <span class="ms-1">{{ activeLease.tenantNames.join(", ") || "â€”" }}</span>
    </div>
    <div class="mb-1">
      <strong>Rent:</strong>
      <span class="ms-1">{{
        activeLease.monthlyRent | currency: "EUR" : "symbol" : "1.2-2"
      }}</span>
      <span *ngIf="activeLease.monthlyCharges > 0" class="text-muted">
        +
        {{
          activeLease.monthlyCharges | currency: "EUR" : "symbol" : "1.2-2"
        }}
        charges ({{ activeLease.chargesType }})
      </span>
    </div>
    <div class="mb-1">
      <strong>Period:</strong>
      <span class="ms-1"
        >{{ activeLease.startDate | date: "dd/MM/yyyy" }} â†’
        {{ activeLease.endDate | date: "dd/MM/yyyy" }}</span
      >
    </div>

    <a
      *ngIf="leases.length > 1"
      routerLink="."
      [queryParams]="{ showHistory: 1 }"
      class="small text-muted mt-2 d-block"
    >
      View all leases ({{ leases.length }})
    </a>
  </div>
</div>
